<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitor Flex vs Axia Solar Comparison Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-navy: #0a2559;
            --alert-red: #ef4444;
            --positive-green: #16a34a;
            --white: #ffffff;
            --light-gray: #f8fafc;
            --light-gray-2: #f1f5f9;
            --light-gray-3: #e2e8f0;
            --medium-gray: #64748b;
            --dark-gray: #1f2937;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            position: static;
        }

        /* Enhanced mobile touch targets */
        button, input, select, textarea {
            -webkit-appearance: none;
            appearance: none;
            -webkit-border-radius: 0;
            border-radius: 0;
        }

        /* Prevent zoom on input focus for iOS */
        input[type="color"],
        input[type="date"],
        input[type="datetime"],
        input[type="datetime-local"],
        input[type="email"],
        input[type="month"],
        input[type="number"],
        input[type="password"],
        input[type="search"],
        input[type="tel"],
        input[type="text"],
        input[type="time"],
        input[type="url"],
        input[type="week"],
        select,
        textarea {
            font-size: 16px;
        }

        /* Smooth scrolling for mobile */
        html {
            -webkit-overflow-scrolling: touch;
        }

        /* Better mobile table scrolling */
        .table-scroll {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }

        .table-scroll::-webkit-scrollbar {
            height: 6px;
        }

        .table-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .table-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .table-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: var(--white);
            color: var(--dark-gray);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .slide-container {
            width: 1280px;
            min-height: 720px;
            background-color: var(--white);
            margin: 0 auto;
            position: relative;
            overflow: hidden;
        }

        .main-container {
            min-height: 100vh;
            background: var(--light-gray);
            padding: 0;
        }

        /* Hide elements when 0% financing is not available */
        .zero-interest-hidden .fixed-plan-column,
        .zero-interest-hidden .fixed-plan-option,
        .zero-interest-hidden .fixed-plan-savings {
            display: none !important;
        }

        /* When escalator is not available, hide the first savings slide (escalator slide) */
        .escalator-hidden #yourPotentialSavingsSlide {
            display: none !important;
        }

        /* Hide elements when escalator is not available */
        .escalator-hidden .escalator-plan-content {
            display: none !important;
        }

        /* Hide oversizing message when not needed */
        .oversizing-hidden .oversizing-message {
            display: none !important;
        }

        .header-band {
            background-color: var(--primary-navy);
            height: 80px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0;
        }

        .header-band h1 {
            color: var(--white);
            font-size: 28px;
            font-weight: 700;
            text-align: center;
        }

        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            width: 50px;
            height: 50px;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .hamburger {
            display: flex;
            flex-direction: column;
            gap: 3px;
            align-items: center;
        }

        .hamburger span {
            display: block;
            width: 20px;
            height: 2px;
            background: white;
            transition: all 0.3s ease;
        }

        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            width: 380px;
            z-index: 1000;
            max-height: 85vh;
            overflow-y: auto;
            transform: translateX(100%);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }

        .control-panel.show {
            transform: translateX(0);
            opacity: 1;
            visibility: visible;
        }

        .control-panel h3 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #0a2559;
            text-align: center;
            font-weight: 700;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }

        .control-panel h4 {
            font-size: 16px;
            margin-bottom: 15px;
            margin-top: 25px;
            color: #0A2559;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
            font-weight: 600;
        }

        .edit-fields {
            margin-bottom: 20px;
        }

        .field-group {
            margin-bottom: 12px;
        }

        .field-group label {
            display: block;
            font-size: 12px;
            color: #374151;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .field-group input, .field-group select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 13px;
            transition: border-color 0.2s;
            background: white;
        }

        .field-group input:focus, .field-group select:focus {
            outline: none;
            border-color: #0A2559;
            box-shadow: 0 0 0 2px rgba(10, 37, 89, 0.1);
        }

        .control-buttons {
            margin-bottom: 15px;
        }

        .control-panel button {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            background: #0A2559;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .control-panel button:hover {
            background: #082047;
        }

        .instructions {
            padding: 12px;
            background: #f9fafb;
            border-radius: 4px;
            margin-top: 10px;
        }

        .instructions p {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 3px;
            line-height: 1.3;
        }

        .content-area {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            background: transparent;
            padding: 0;
            border-radius: 0;
            border: none;
            box-shadow: none;
        }

        .input-group label {
            font-weight: 500;
            color: var(--dark-gray);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            text-transform: none;
            letter-spacing: normal;
        }

        .input-group input,
        .input-group select {
            padding: 12px 16px;
            border: 1px solid var(--light-gray-3);
            border-radius: 0;
            font-size: 1rem;
            transition: all 0.2s ease;
            background: var(--white);
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-navy);
            box-shadow: 0 0 0 3px rgba(10, 37, 89, 0.1);
        }

        .input-section {
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid #f3f4f6;
        }

        .input-section:last-of-type {
            border-bottom: none;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-navy);
            text-align: center;
            margin-bottom: 1.5rem;
            margin-top: 0;
        }

        .slide {
            background: var(--white);
            border-radius: 0;
            padding: 60px;
            margin-bottom: 0;
            box-shadow: none;
            border: none;
            border-top: 1px solid var(--light-gray-3);
            min-height: 720px;
            width: 1280px;
            display: block;
            overflow: visible;
        }

        .slide:last-child {
            height: auto;
            min-height: 800px;
        }

        .slide h2 {
            font-size: 2.75rem;
            font-weight: 700;
            color: var(--primary-navy);
            margin-bottom: 2.5rem;
            text-align: center;
            line-height: 1.2;
        }

        .icon-container {
            background-color: var(--primary-navy);
            color: var(--white);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: var(--light-gray);
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            border-left: 4px solid var(--primary-navy);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-navy);
            margin-bottom: 1rem;
        }

        .stat-card p {
            color: var(--medium-gray);
            font-size: 1rem;
            font-weight: 500;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 3rem;
            margin-top: 3rem;
        }

        .comparison-card {
            background: var(--white);
            border-radius: 12px;
            padding: 2.5rem;
            border-left: 4px solid;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .comparison-card.competitor {
            border-left-color: var(--alert-red);
        }

        .comparison-card.our-system {
            border-left-color: var(--positive-green);
        }

        .comparison-card h3 {
            font-size: 1.875rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .comparison-card.competitor h3 {
            color: var(--alert-red);
        }

        .comparison-card.our-system h3 {
            color: var(--positive-green);
        }

        .production-display {
            text-align: center;
            margin-bottom: 2rem;
            background: var(--white);
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary-navy);
        }

        .production-value {
            font-size: 2.75rem;
            font-weight: 700;
            display: block;
            color: var(--primary-navy);
        }

        .production-unit {
            font-size: 1.1rem;
            color: var(--medium-gray);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .pricing {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .price-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .price-label {
            font-weight: 500;
            color: #374151;
        }

        .price-value {
            font-size: 1.25rem;
            font-weight: 600;
            color: #111827;
        }

        .chart-container {
            background: #ffffff;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #f3f4f6;
        }

        .cost-summary,
        .savings-highlight,
        .environmental-stats,
        .recommendation-content {
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid #e2e8f0;
        }

        .payment-table {
            overflow-x: auto;
            margin-top: 2rem;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .payment-table table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            border-radius: 12px;
            overflow: hidden;
        }

        .payment-table th,
        .payment-table td {
            padding: 1.2rem;
            text-align: center;
            border-bottom: 1px solid var(--light-gray-3);
        }

        .payment-table th {
            background: var(--primary-navy);
            font-weight: 700;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.95rem;
        }

        .payment-table td {
            color: var(--dark-gray);
            font-weight: 500;
        }

        .savings-number {
            font-size: 3.5rem;
            font-weight: 700;
            color: var(--positive-green);
            text-align: center;
            margin: 1.5rem 0;
            text-shadow: 0 2px 4px rgba(22, 163, 74, 0.2);
        }

        .environmental-stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            background: var(--white);
            border-radius: 0;
            margin-bottom: 1rem;
            border-left: 4px solid var(--positive-green);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .environmental-stat i {
            font-size: 2.2rem;
            color: var(--positive-green);
            margin-right: 1.5rem;
        }

        .recommendation-badge {
            display: inline-block;
            background: var(--positive-green);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border-radius: 0;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 12px rgba(22, 163, 74, 0.3);
        }

        .update-button {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, var(--primary-navy) 0%, #1e40af 100%);
            color: var(--white);
            border: none;
            padding: 18px 36px;
            border-radius: 0;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            justify-self: center;
            min-width: 220px;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(10, 37, 89, 0.3);
        }

        .update-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .update-button:hover::before {
            left: 100%;
        }

        .update-button:hover {
            background: linear-gradient(135deg, #1e40af 0%, var(--primary-navy) 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(10, 37, 89, 0.4);
        }

        .update-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(10, 37, 89, 0.3);
        }

        .pdf-button {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
            min-width: 200px;
        }

        .pdf-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
        }

        .pdf-button i {
            margin-right: 8px;
        }

        .input-section {
            margin-bottom: 2.5rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--light-gray-3);
        }

        .hidden {
            display: none;
        }

        .analysis-content {
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .analysis-content.show {
            opacity: 1;
        }

        .diagram-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 24px;
        }

        /* Desktop styles - ensure slides maintain full size */
        @media (min-width: 769px) {
            .slide-container {
                width: 1280px;
                min-height: 720px;
                background-color: var(--white);
                margin: 0 auto;
                position: relative;
                overflow: hidden;
            }

            .slide {
                background: var(--white);
                border-radius: 0;
                padding: 60px;
                margin-bottom: 0;
                box-shadow: none;
                border: none;
                border-top: 1px solid var(--light-gray-3);
                min-height: 720px;
                width: 1280px;
                display: block;
                overflow: visible;
            }

            .slide:last-child {
                height: auto;
                min-height: 800px;
            }
        }

        @media (max-width: 768px) {
            /* General mobile layout */
            body {
                padding: 10px;
                font-size: 14px;
            }

            .container {
                padding: 10px;
                margin: 0;
            }

            /* Header adjustments */
            .header {
                padding: 15px 20px;
                text-align: center;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            /* Control panel mobile */
            .control-panel {
                padding: 20px 15px;
                margin-bottom: 15px;
            }

            .control-panel h3 {
                font-size: 1.5rem;
                text-align: center;
                margin-bottom: 20px;
            }

            .input-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .input-group label {
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .input-group input {
                padding: 12px;
                font-size: 16px; /* Prevents zoom on iOS */
                border-radius: 8px;
            }

            /* Update button mobile */
            .update-button {
                width: 100%;
                padding: 15px;
                font-size: 1.1rem;
                margin: 20px 0;
            }

            /* Slides mobile layout */
            .slide {
                padding: 20px;
                margin-bottom: 10px;
                border-radius: 8px;
                width: 100% !important;
                min-height: auto !important;
            }

            .slide-container {
                width: 100% !important;
                min-height: auto !important;
            }

            .slide h2 {
                font-size: 1.6rem;
                text-align: center;
                margin-bottom: 20px;
            }

            /* Chart containers mobile */
            .chart-container {
                height: 300px;
                margin-bottom: 20px;
                padding: 10px;
            }

            /* Access comparison mobile */
            .access-metrics {
                flex-direction: column;
                gap: 15px;
            }

            .access-metric {
                text-align: center;
                padding: 15px;
            }

            .access-metric h4 {
                font-size: 1rem;
            }

            .access-metric .metric-value {
                font-size: 1.8rem;
            }

            /* Comparison table mobile */
            .comparison-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .comparison-table {
                min-width: 600px;
                font-size: 0.8rem;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px 6px;
                white-space: nowrap;
            }

            /* Financial impact table mobile */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin: 15px 0;
            }

            .impact-table {
                min-width: 700px;
                font-size: 0.85rem;
            }

            .impact-table th,
            .impact-table td {
                padding: 12px 8px;
            }

            /* Recommendation section mobile */
            .recommendation-badge {
                font-size: 0.8rem;
                padding: 6px 12px;
            }

            /* Price displays mobile */
            .price-badge {
                padding: 8px 12px;
                font-size: 0.9rem;
            }

            .price-value {
                font-size: 1.2rem;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 15px;
                text-align: center;
            }

            .stat-card h4 {
                font-size: 0.9rem;
            }

            .stat-card .stat-value {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            /* Extra small screens */
            .header h1 {
                font-size: 1.5rem;
            }

            .slide h2 {
                font-size: 1.4rem;
            }

            .chart-container {
                height: 250px;
            }

            .comparison-table,
            .impact-table {
                font-size: 0.75rem;
            }

            .comparison-table th,
            .comparison-table td,
            .impact-table th,
            .impact-table td {
                padding: 6px 4px;
            }

            .input-group input {
                padding: 10px;
            }

            .update-button {
                padding: 12px;
                font-size: 1rem;
            }
        }

        /* Chart Type Selector Styles */
        .chart-type-btn {
            transition: all 0.3s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .chart-type-btn:hover {
            background: #1e40af !important;
            color: white !important;
        }

        .chart-type-btn.active {
            background: #0a2559 !important;
            color: white !important;
        }

        .chart-type-btn:not(.active) {
            background: transparent !important;
            color: #0a2559 !important;
        }

        .chart-type-btn:not(.active):hover {
            background: #f1f5f9 !important;
            color: #0a2559 !important;
        }

        /* Compact table styling for third slide */
        .slide table td {
            padding: 14px 16px !important;
        }

        .slide table td div {
            font-size: 1rem !important;
            margin-bottom: 4px !important;
        }

        .slide table td div:nth-child(2) {
            font-size: 0.75rem !important;
        }

        .slide table td:first-child {
            font-size: 0.9rem !important;
        }

        /* Print styles to remove headers and footers */
        
        .personalization-panel .input-group {
            margin-bottom: 30px;
        }
        
        .personalization-panel .input-group label {
            display: block;
            color: #0a2559;
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        .personalization-panel .input-group input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .update-btn {
            background: #0a2559;
            color: white;
            padding: 20px 32px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 25px 0;
            font-size: 18px;
        }
        
        .update-btn:hover {
            background: #1e40af;
        }
        
        .toggle-panel {
            position: fixed;
            top: 10px;
            left: 610px;
            background: #0a2559;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
            transition: left 0.3s ease;
        }
        
        .toggle-panel.panel-hidden {
            left: 10px;
        }
        
        /* Custom select styles with hover arrow */
        .custom-select {
            position: relative;
            background-image: none !important;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            background-color: white;
            padding-right: 45px !important; /* Space for arrow */
            padding: 15px !important;
            font-size: 16px !important;
            border-radius: 8px !important;
        }
        
        .input-group {
            position: relative;
        }
        
        /* Hide default arrow and show custom one on hover */
        .input-group:has(.custom-select)::after {
            content: '▼';
            position: absolute;
            right: 12px;
            top: calc(100% - 24px); /* Adjusted for larger elements */
            color: #0a2559;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1;
        }
        
        .input-group:hover:has(.custom-select)::after {
            opacity: 1;
        }
        
        /* Fallback for browsers that don't support :has() */
        .input-group.select-container::after {
            content: '▼';
            position: absolute;
            right: 12px;
            top: calc(100% - 24px); /* Adjusted for larger elements */
            color: #0a2559;
            font-size: 14px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1;
        }
        
        .input-group.select-container:hover::after {
            opacity: 1;
        }

        /* Print styles to remove headers and footers */
        @media print {
            @page {
                margin: 0.5in;
                size: A4 landscape;
            }
            
            /* Ensure consistent PDF slide sizing for both Flex Program and Another Competitor modes */
            .slide-container {
                width: 1280px !important;
                min-height: 720px !important;
                max-width: 1280px !important;
            }
            
            /* Uniform slide dimensions for PDF generation regardless of competitor mode */
            .slide {
                width: 1280px !important;
                min-height: 720px !important;
                max-width: 1280px !important;
                box-sizing: border-box !important;
            }
            
            /* Hide headers and footers completely */
            @page :first {
                @top-left { content: ""; }
                @top-center { content: ""; }
                @top-right { content: ""; }
                @bottom-left { content: ""; }
                @bottom-center { content: ""; }
                @bottom-right { content: ""; }
            }
            
            @page :left {
                @top-left { content: ""; }
                @top-center { content: ""; }
                @top-right { content: ""; }
                @bottom-left { content: ""; }
                @bottom-center { content: ""; }
                @bottom-right { content: ""; }
            }
            
            @page :right {
                @top-left { content: ""; }
                @top-center { content: ""; }
                @top-right { content: ""; }
                @bottom-left { content: ""; }
                @bottom-center { content: ""; }
                @bottom-right { content: ""; }
            }
            
            /* Additional print optimizations */
            body {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Hide control elements */
            .control-panel,
            .menu-toggle {
                display: none !important;
            }

            /* Hide Powered by header in PDF */
            .header-band {
                display: none !important;
            }
            
            /* Ensure consistent main container sizing for PDF in both modes */
            .main-container {
                width: 1280px !important;
                max-width: 1280px !important;
                margin: 0 auto !important;
                padding: 0 !important;
            }
            
            .analysis-content {
                width: 1280px !important;
                max-width: 1280px !important;
                margin: 0 auto !important;
            }

            /* Adjust first slide for PDF layout */
            .slide:first-child {
                margin-top: 0 !important;
                padding-top: 20px !important;
                page-break-before: avoid;
                break-before: avoid;
            }

            /* Optimize slide spacing for PDF */
            .slide {
                page-break-inside: avoid;
                break-inside: avoid;
                padding: 40px !important;
                min-height: 680px !important;
            }
            
            /* Ensure consistent chart sizing for PDF generation in both competitor modes */
            .chart-container {
                height: 400px !important; /* Use same height as Flex Program for consistency */
                max-height: 400px !important;
                width: 100% !important;
                box-sizing: border-box !important;
            }
            
            /* Override Another Competitor larger chart size in PDF to match Flex Program */
            #savingsChartContainer {
                height: 400px !important; /* Force same size as Flex Program */
                max-height: 400px !important;
            }            /* Hide chart type buttons in PDF */
            .chart-type-btn {
                display: none !important;
            }
            
            /* Keep chart and summaries together */
            .chart-container {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-after: avoid;
                break-after: avoid;
            }
            
            /* Keep summary section with chart */
            .chart-container + div {
                page-break-before: avoid;
                break-before: avoid;
                page-break-inside: avoid;
                break-inside: avoid;
            }
            
            /* Keep entire third slide together */
            #slide-3 {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: always;
                break-before: page;
            }

            /* Partial vs Full Access slide (now separate) */
            #partialVsFullAccessSlide {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: auto;
                break-before: auto;
                padding: 30px !important;
            }

            /* Annual Financial Impact slide (new separate slide) */
            #annualFinancialImpactSlide {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: always;
                break-before: page;
                padding: 30px !important;
            }

            #annualFinancialImpactSlide h2 {
                font-size: 1.8rem !important;
                margin-bottom: 1.5rem !important;
            }

            #annualFinancialImpactSlide .chart-container {
                height: 320px !important;
                margin-bottom: 1.5rem !important;
            }

            /* Monthly Payment Evolution Analysis slide optimization for PDF */
            #monthlyPaymentSlide {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: always;
                break-before: page;
                padding: 30px !important;
                width: 1280px !important;
                min-height: 720px !important;
            }

            #monthlyPaymentSlide h2 {
                font-size: 1.8rem !important;
                margin-bottom: 1rem !important;
            }

            #monthlyPaymentSlide .chart-container {
                height: 400px !important; /* Consistent with Flex Program sizing */
                margin-bottom: 1rem !important;
                padding: 1rem !important;
                max-height: 400px !important;
            }

            /* Financial Impact Table slide optimization for PDF */
            #financialImpactTableSlide {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: always;
                break-before: page;
                padding: 25px !important;
            }

            #financialImpactTableSlide h2 {
                font-size: 1.6rem !important;
                margin-bottom: 1rem !important;
            }

            #financialImpactTableSlide table th,
            #financialImpactTableSlide table td {
                padding: 14px 16px !important;
                font-size: 0.9rem !important;
                line-height: 1.3 !important;
            }

            #financialImpactTableSlide table td div {
                font-size: 0.9rem !important;
                margin-bottom: 4px !important;
                line-height: 1.2 !important;
            }

            #financialImpactTableSlide table td div:first-child {
                font-size: 1rem !important;
                font-weight: 600 !important;
            }

            /* Your Potential Savings slide - back to original sizing */
            #yourPotentialSavingsSlide {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: always !important;
                break-before: page !important;
                padding: 25px !important; /* Back to original padding */
                min-height: 720px !important;
                max-height: none !important;
                height: auto !important;
                width: 1280px !important;
            }

            #yourPotentialSavingsSlide h2 {
                font-size: 1.6rem !important; /* Back to original size */
                margin-bottom: 0.8rem !important; /* Original margin */
            }

            /* Savings highlight box - EXACT copy of Fixed Plan settings */
            #yourPotentialSavingsSlide .savings-highlight {
                padding: 12px !important; /* EXACT Fixed Plan */
                margin-bottom: 0.8rem !important; /* EXACT Fixed Plan */
                font-size: 0.8rem !important; /* EXACT Fixed Plan */
                page-break-inside: avoid !important;
                break-inside: avoid !important;
            }

            #yourPotentialSavingsSlide .savings-highlight h3 {
                font-size: 0.9rem !important; /* EXACT Fixed Plan */
                margin-bottom: 0.4rem !important; /* EXACT Fixed Plan */
            }

            #yourPotentialSavingsSlide .savings-highlight h4 {
                font-size: 0.85rem !important; /* EXACT Fixed Plan */
                margin-bottom: 0.3rem !important; /* EXACT Fixed Plan */
            }

            #yourPotentialSavingsSlide .savings-highlight .savings-item {
                padding: 6px 10px !important; /* EXACT Fixed Plan */
                margin-bottom: 4px !important; /* EXACT Fixed Plan */
            }

            #yourPotentialSavingsSlide .savings-highlight .savings-value {
                font-size: 1.2rem !important; /* EXACT Fixed Plan */
                line-height: 1.1 !important; /* EXACT Fixed Plan */
            }

            /* Chart container - maximized for PDF generation */
            #yourPotentialSavingsSlide .chart-container {
                height: 550px !important; /* Increased height for PDF */
                max-height: 550px !important;
                margin: 0.3rem auto !important; /* Reduced margins for more space */
                padding: 0.5rem !important; /* Reduced padding for more chart space */
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: avoid !important;
                break-before: avoid !important;
                page-break-after: avoid !important;
                break-after: avoid !important;
                width: 100% !important; /* Full width */
                max-width: 100% !important; /* No width restriction */
                box-sizing: border-box !important;
            }

            /* Recommendation section - similar to Fixed Plan style */
            #yourPotentialSavingsSlide .recommendation-content {
                padding: 12px !important; /* Same as savings highlight */
                margin: 0.8rem 0 !important; /* Same as Fixed Plan */
                font-size: 0.8rem !important; /* Same as Fixed Plan */
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: avoid !important;
                break-before: avoid !important;
            }

            #yourPotentialSavingsSlide .recommendation-badge {
                font-size: 0.7rem !important;
                padding: 0.3rem 0.6rem !important;
                margin-bottom: 0.3rem !important;
            }

            #yourPotentialSavingsSlide .recommendation-content h3 {
                font-size: 0.9rem !important; /* Match savings h3 */
                margin-bottom: 0.3rem !important;
            }

            #yourPotentialSavingsSlide .recommendation-content p {
                font-size: 0.75rem !important;
                line-height: 1.1 !important;
                margin-bottom: 0.2rem !important;
            }

            #yourPotentialSavingsSlide .recommendation-content .savings-number {
                font-size: 1.4rem !important;
                margin: 0.3rem 0 !important;
            }

            /* Force all elements to stay together */
            #yourPotentialSavingsSlide .savings-highlight,
            #yourPotentialSavingsSlide .chart-container,
            #yourPotentialSavingsSlide .recommendation-content {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: avoid !important;
                break-before: avoid !important;
                page-break-after: avoid !important;
                break-after: avoid !important;
            }

            /* Fixed Plan Savings slide optimization for PDF */
            #fixedPlanSavingsSlide {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: always;
                break-before: page;
                padding: 25px !important;
            }

            /* Compact savings highlight box for fixed plan */
            #fixedPlanSavingsSlide .savings-highlight {
                padding: 12px !important;
                margin-bottom: 0.8rem !important;
                font-size: 0.8rem !important;
            }

            #fixedPlanSavingsSlide .savings-highlight h3 {
                font-size: 0.9rem !important;
                margin-bottom: 0.4rem !important;
            }

            #fixedPlanSavingsSlide .savings-highlight h4 {
                font-size: 0.85rem !important;
                margin-bottom: 0.3rem !important;
            }

            #fixedPlanSavingsSlide .savings-highlight .savings-item {
                padding: 6px 10px !important;
                margin-bottom: 4px !important;
            }

            #fixedPlanSavingsSlide .savings-highlight .savings-value {
                font-size: 1.2rem !important;
                line-height: 1.1 !important;
            }

            /* Optimize chart container for fixed plan */
            #fixedPlanSavingsSlide .chart-container {
                height: 380px !important;
                margin-bottom: 0.5rem !important;
            }

            /* Comparison Table slide optimization for PDF - make table bigger */
            #comparisonTableSlide {
                page-break-inside: avoid;
                break-inside: avoid;
                page-break-before: always;
                break-before: page;
                padding: 20px !important;
                width: 1280px !important;
                min-height: 720px !important;
            }

            #comparisonTableSlide h2 {
                font-size: 1.6rem !important;
                margin-bottom: 1.2rem !important;
                text-align: center !important;
            }

            /* Make comparison table bigger and more readable */
            #comparisonTableSlide table {
                margin-bottom: 0 !important;
                width: 90% !important;
                margin-left: auto !important;
                margin-right: auto !important;
                table-layout: fixed !important;
            }

            #comparisonTableSlide table th:first-child,
            #comparisonTableSlide table td:first-child {
                width: 25% !important;
            }

            #comparisonTableSlide table th:nth-child(2),
            #comparisonTableSlide table td:nth-child(2) {
                width: 37.5% !important;
            }

            #comparisonTableSlide table th:nth-child(3),
            #comparisonTableSlide table td:nth-child(3) {
                width: 37.5% !important;
            }

            #comparisonTableSlide table th,
            #comparisonTableSlide table td {
                padding: 16px 12px !important;
                font-size: 0.9rem !important;
                line-height: 1.4 !important;
                word-wrap: break-word !important;
                vertical-align: top !important;
            }

            #comparisonTableSlide table th {
                font-size: 0.85rem !important;
            }

            #comparisonTableSlide table td div {
                font-size: 0.85rem !important;
                margin-bottom: 3px !important;
                line-height: 1.3 !important;
            }

            #comparisonTableSlide table .fas {
                font-size: 0.8rem !important;
            }
            
            /* Our Recommendation slide optimization for PDF - more aggressive sizing */
            .slide:last-child {
                page-break-inside: avoid !important;
                break-inside: avoid !important;
                page-break-before: always !important;
                break-before: page !important;
                padding: 12px !important;
                min-height: 600px !important;
                height: auto !important;
            }
            
            .slide:last-child h2 {
                font-size: 1.3rem !important;
                margin-bottom: 0.6rem !important;
            }
            
            .slide:last-child .recommendation-content {
                padding: 8px !important;
                margin: 6px 0 !important;
                font-size: 0.75rem !important;
            }
            
            .slide:last-child .recommendation-badge {
                font-size: 0.7rem !important;
                padding: 5px 10px !important;
                margin-bottom: 6px !important;
            }
            
            .slide:last-child .recommendation-content h3 {
                font-size: 1rem !important;
                margin-bottom: 5px !important;
            }
            
            .slide:last-child .recommendation-content p {
                font-size: 0.75rem !important;
                line-height: 1.2 !important;
                margin-bottom: 5px !important;
            }
            
            .slide:last-child .savings-number {
                font-size: 1.8rem !important;
                margin: 6px 0 !important;
            }
            
            .slide:last-child .environmental-stats {
                padding: 6px !important;
                margin: 6px 0 !important;
            }
            
            .slide:last-child .environmental-stat {
                padding: 6px !important;
                margin-bottom: 4px !important;
            }
            
            .slide:last-child .environmental-stat i {
                font-size: 1.3rem !important;
                margin-right: 6px !important;
            }
            
            .slide:last-child .environmental-stat div {
                font-size: 0.75rem !important;
                line-height: 1.2 !important;
            }
            .slide:last-child h2 {
                font-size: 1.3rem !important;
                margin-bottom: 0.8rem !important;
            }
            
            .slide:last-child .recommendation-content {
                padding: 1rem !important;
                margin: 0.5rem 0 !important;
                font-size: 0.85rem !important;
                line-height: 1.3 !important;
            }
            
            
            /* Optimize third slide table for PDF */
            #slide-3 {
                padding: 30px !important;
            }

            #slide-3 h2 {
                font-size: 1.8rem !important;
                margin-bottom: 1rem !important;
            }

            #slide-3 table th,
            #slide-3 table td {
                padding: 8px 12px !important;
                font-size: 0.75rem !important;
                line-height: 1.2 !important;
            }

            #slide-3 table td div {
                font-size: 0.75rem !important;
                margin-bottom: 2px !important;
                line-height: 1.1 !important;
            }

            #slide-3 table td div:first-child {
                font-size: 0.85rem !important;
                font-weight: 600 !important;
            }

            #slide-3 .chart-container {
                height: 280px !important;
                margin-bottom: 1rem !important;
                padding: 1rem !important;
            }

            #slide-3 h3 {
                font-size: 1.1rem !important;
                margin-bottom: 0.8rem !important;
            }

            #slide-3 > div {
                margin: 1rem 0 !important;
            }

            /* Chart type buttons in PDF */
            #slide-3 .chart-type-btn {
                padding: 4px 8px !important;
                font-size: 0.7rem !important;
            }

            /* Keep slide title with content */
            #slide-3 h2 {
                page-break-after: avoid;
                break-after: avoid;
            }
            
            /* Specific rules for "Another Competitor" mode when access/impact slides are hidden */
            /* When partialVsFullAccessSlide is hidden, ensure proper page flow */
            #partialVsFullAccessSlide[style*="display: none"] ~ #monthlyPaymentSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            /* When annualFinancialImpactSlide is hidden, ensure proper page flow */
            #annualFinancialImpactSlide[style*="display: none"] ~ #monthlyPaymentSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            /* Ensure Your Potential Savings slide gets proper page break in Another Competitor mode */
            body:not(.competitor-mode) #yourPotentialSavingsSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            /* For Another Competitor: ensure Monthly Payment slide starts on new page after System Comparison */
            .slide:nth-child(2) + #monthlyPaymentSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            /* Ensure slides flow properly when competitor-specific slides are hidden */
            #monthlyPaymentSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            #financialImpactTableSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            #yourPotentialSavingsSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            #comparisonTableSlide {
                page-break-before: always !important;
                break-before: page !important;
            }
            
            /* Universal PDF slide sizing - ensures all slides have consistent dimensions regardless of competitor mode */
            .slide,
            #slide-3,
            #partialVsFullAccessSlide,
            #annualFinancialImpactSlide,
            #monthlyPaymentSlide,
            #financialImpactTableSlide,
            #yourPotentialSavingsSlide,
            #fixedPlanSavingsSlide,
            #comparisonTableSlide,
            .slide:last-child {
                width: 1280px !important;
                min-width: 1280px !important;
                max-width: 1280px !important;
                min-height: 720px !important;
                box-sizing: border-box !important;
                margin: 0 auto !important;
                overflow: hidden !important;
            }
            
            /* Ensure all chart containers use consistent sizing in PDF */
            .slide .chart-container,
            #slide-3 .chart-container,
            #partialVsFullAccessSlide .chart-container,
            #annualFinancialImpactSlide .chart-container,
            #monthlyPaymentSlide .chart-container,
            #financialImpactTableSlide .chart-container,
            #fixedPlanSavingsSlide .chart-container,
            #savingsChartContainer {
                height: 400px !important;
                max-height: 400px !important;
                width: auto !important;
                max-width: 100% !important;
            }
            
            /* Special sizing for Your Potential Savings slide - horizontal expansion only */
            #yourPotentialSavingsSlide .chart-container {
                height: 480px !important; /* Back to working height */
                max-height: 480px !important;
                width: 95% !important; /* Wider to use more available space */
                max-width: 95% !important; /* Expand horizontally toward the right */
                margin: 0.8rem auto !important; /* Restore original margins */
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
            
            /* Ensure chart canvas elements scale properly in PDF */
            .chart-container canvas,
            #yourPotentialSavingsSlide canvas,
            #savingsChartContainer canvas {
                max-width: 100% !important;
                width: 100% !important; /* Force canvas to stretch horizontally */
                height: auto !important;
                max-height: 100% !important;
                object-fit: contain !important;
            }
            
            /* Specific canvas sizing for Your Potential Savings slide */
            #yourPotentialSavingsSlide canvas {
                width: 100% !important; /* Stretch canvas to fill available width */
                max-width: none !important; /* Remove width restrictions */
            }
        }
    </style>
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="menu-toggle" onclick="toggleControlPanel()">
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </button>

    <!-- Control Panel -->
    <div class="control-panel">
        <h3>Customize Presentation</h3>
        
        <!-- Client Name -->
        <div class="field-group">
            <label>Client Name:</label>
            <input type="text" id="clientNameInput" value="Valued Customer" placeholder="Full name">
        </div>
        
        <!-- Competitor Selection -->
        <div class="field-group">
            <label>Select Competitor:</label>
            <select id="competitorTypeSelect" onchange="updateCompetitorType()">
                <option value="flex">Flex Program</option>
                <option value="other">Another Competitor</option>
            </select>
        </div>
        
        <h4>Competitor Data:</h4>
        
        <!-- Flex Program Fields -->
        <div id="flexProgramFields">
            <div class="field-group">
                <label>Base Line Production (kWh):</label>
                <input type="number" id="sunrunBaseProductionInput" value="9605" placeholder="9605">
            </div>
            
            <div class="field-group">
                <label>Flex Production (kWh):</label>
                <input type="number" id="sunrunFlexProductionInput" value="13469" placeholder="13469">
            </div>
            
            <div class="field-group">
                <label>Base Price ($/month):</label>
                <input type="number" id="sunrunBasePriceInput" value="215.14" step="0.01" placeholder="215.14" onchange="updatePresentationAndRefresh()">
            </div>
            
            <div class="field-group">
                <label>Flex Price ($/month):</label>
                <input type="number" id="sunrunFlexPriceInput" value="248.96" step="0.01" placeholder="248.96" onchange="updatePresentationAndRefresh()">
            </div>
            
            <div class="field-group">
                <label>Competitor Escalator (%):</label>
                <input type="number" id="sunrunEscalatorInput" value="3.5" step="0.1" placeholder="3.5">
            </div>
        </div>
        
        <!-- Other Competitor Fields -->
        <div id="otherCompetitorFields" style="display: none;">
            <div class="field-group">
                <label>Competitor Production (kWh):</label>
                <input type="number" id="competitorProductionInput" value="13469" placeholder="13469">
            </div>
            
            <div class="field-group">
                <label>Competitor Price ($/month):</label>
                <input type="number" id="competitorPriceInput" value="215.14" step="0.01" placeholder="215.14" onchange="updatePresentationAndRefresh()">
            </div>
            
            <div class="field-group">
                <label>Competitor Escalator (%):</label>
                <input type="number" id="competitorEscalatorInput" value="3.5" step="0.1" placeholder="3.5">
            </div>
        </div>
        
        <h4>Axia Data:</h4>
        
        <div class="field-group">
            <label>Our Production (kWh):</label>
            <input type="number" id="ourProductionInput" value="12106" placeholder="12106" onchange="updatePresentation()">
        </div>
        
        <div class="field-group">
            <label>Our Price ($/month):</label>
            <input type="number" id="ourPriceInput" value="195.13" step="0.01" placeholder="195.13" onchange="updatePresentationAndRefresh()">
        </div>
        
        <div class="field-group">
            <label>Fixed Price ($/month):</label>
            <input type="number" id="ourFixedPriceInput" value="280.19" step="0.01" placeholder="280.19" onchange="updatePresentationAndRefresh()">
        </div>
        
        <div class="field-group">
            <label>Our Escalator (%):</label>
            <select id="ourEscalatorInput" onchange="updatePresentation()">
                <option value="3.5">3.5%</option>
                <option value="2.99">2.99%</option>
                <option value="none">No Escalator</option>
            </select>
        </div>
        
        <div class="field-group">
            <label>0% Interest Financing Available:</label>
            <select id="zeroInterestAvailableInput" onchange="updatePresentation()">
                <option value="yes">Yes - Include in calculations</option>
                <option value="no">No - Do not include</option>
            </select>
        </div>
        
        <div class="field-group">
            <label>Show Oversizing Message:</label>
            <select id="oversizedMessageInput" onchange="updatePresentation()">
                <option value="yes">Yes - Show oversizing content</option>
                <option value="no">No - Hide oversizing content</option>
            </select>
        </div>
        
        <div class="control-buttons">
            <button onclick="updatePresentation()">Update Presentation</button>
            <button onclick="printProposal()">Generate PDF</button>
        </div>
        
        <div class="instructions">
            <p><strong>Instructions:</strong></p>
            <p>1. Modify values above</p>
            <p>2. Click "Update Presentation"</p>
            <p>3. Click "Generate PDF" to export</p>
            <p>4. Review changes in all slides</p>
        </div>
    </div>

    <div class="main-container">
        <div class="slide-container">
            <!-- Analysis Content - Now the main content -->
            <div class="analysis-content" id="analysisContent" style="opacity: 1;">
                    <!-- Header Band inside analysis content -->
                    <div class="header-band">
                        <h1>Powered by Axia and Qcells</h1>
                    </div>
                    
                    <!-- The Qcells Family of Companies - Enhanced Overview Slide -->
                    <div class="slide">
                        <h2 style="color: #0a2559; font-size: 2.2rem; font-weight: 700; text-align: left; margin-bottom: 0.8rem; margin-top: 0; padding-top: 0;">Why Choose Axia by Qcells?</h2>
                        <div style="width: 100px; height: 3px; background: #0a2559; margin-bottom: 0.8rem;"></div>
                        <h3 style="color: #0a2559; font-size: 1.3rem; font-weight: 500; text-align: left; margin-bottom: 2.5rem; margin-top: 0; font-style: italic; line-height: 1.4;">The Power of One Company: <span style="font-size: 1.1rem;">industry-leading panels, professional installation, and fast financing.</span></h3>
                        
                        <div style="display: flex; justify-content: flex-start; align-items: flex-start; max-width: 1200px; margin: 0 auto; padding: 0 1rem; gap: 0.8rem;">
                            <!-- Left Side - Company Image -->
                            <div style="width: 300px; flex-shrink: 0;">
                                <img src="Tesla-solar-tool_Files/one-company-axia-highlighted-1024x966.webp" alt="One Company Ecosystem" style="width: 100%; height: auto; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1);">
                            </div>
                            
                            <!-- Center Content - Company Cards -->
                            <div style="flex: 1; max-width: 550px; margin-left: 1rem;">
                                <!-- Companies List - Stacked Vertically -->
                                <div style="display: flex; flex-direction: column; gap: 1.4rem;">
                                    <!-- AXIA Sales & Service - Left aligned -->
                                    <div style="margin-left: 0; position: relative; padding: 0.8rem; background: #fff; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.06); border-left: 3px solid #ff6b35; width: 400px;">
                                        <h4 style="color: #ff6b35; font-size: 0.9rem; font-weight: 700; margin-bottom: 0.4rem; display: flex; align-items: center;">
                                            <span style="color: #ff6b35; margin-right: 0.5rem; font-size: 1rem;">•</span>
                                            AXIA Sales & Service
                                        </h4>
                                        <p style="color: #2d3748; font-size: 0.75rem; margin: 0; line-height: 1.3; margin-left: 1.3rem;">Expert consultation, transparent pricing, and dedicated installation support for a superior solar experience.</p>
                                    </div>
                                    
                                    <!-- QCELLS Manufacturing - Right offset with same width -->
                                    <div style="margin-left: 80px; position: relative; padding: 0.8rem; background: #fff; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.06); border-left: 3px solid #0a2559; width: 400px;">
                                        <h4 style="color: #0a2559; font-size: 0.9rem; font-weight: 700; margin-bottom: 0.4rem; display: flex; align-items: center;">
                                            <span style="color: #0a2559; margin-right: 0.5rem; font-size: 1rem;">•</span>
                                            QCELLS Manufacturing
                                        </h4>
                                        <p style="color: #2d3748; font-size: 0.75rem; margin: 0; line-height: 1.3; margin-left: 1.3rem;">Global leader producing the #1 trusted solar panels in the US, assembled in America with cutting-edge technology.</p>
                                    </div>
                                    
                                    <!-- ENFIN Financing - Left aligned with same width -->
                                    <div style="margin-left: 0; position: relative; padding: 0.8rem; background: #fff; border-radius: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.06); border-left: 3px solid #2563eb; width: 400px;">
                                        <h4 style="color: #2563eb; font-size: 0.9rem; font-weight: 700; margin-bottom: 0.4rem; display: flex; align-items: center;">
                                            <span style="color: #2563eb; margin-right: 0.5rem; font-size: 1rem;">•</span>
                                            ENFIN Financing
                                        </h4>
                                        <p style="color: #2d3748; font-size: 0.75rem; margin: 0; line-height: 1.3; margin-left: 1.3rem;">Flexible financing solutions with competitive rates and quick approval, seamlessly integrated into our ecosystem.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Side - Solar Tips -->
                            <div style="flex-shrink: 0; width: 280px; margin-left: 1rem; display: flex; align-items: center; justify-content: center;">
                                <!-- Small Solar Tips Box -->
                                <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-top: 3rem;">
                                    <!-- Header -->
                                    <div style="margin-bottom: 0.75rem; padding-bottom: 0.4rem; border-bottom: 1px solid #cbd5e1;">
                                        <h3 style="color: #0a2559; font-size: 0.7rem; font-weight: 600; margin: 0; text-transform: uppercase; letter-spacing: 0.2px;">
                                            Tips - Before Signing Solar
                                        </h3>
                                    </div>
                                    
                                    <!-- Tips Items -->
                                    <div>
                                        
                                        <!-- Tip 1 -->
                                        <div style="display: flex; align-items: flex-start; margin-bottom: 0.6rem;">
                                            <span style="color: #0a2559; font-size: 0.6rem; margin-right: 0.3rem; margin-top: 0.05rem;">✓</span>
                                            <div>
                                                <div style="color: #0a2559; font-weight: 600; font-size: 0.65rem; line-height: 1.2; margin-bottom: 0.15rem;">
                                                    Request total 25-year price
                                                </div>
                                                <div style="color: #64748b; font-size: 0.55rem; line-height: 1.2;">
                                                    It is important to see the full pricing picture over time.
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Tip 2 -->
                                        <div style="display: flex; align-items: flex-start; margin-bottom: 0.6rem;">
                                            <span style="color: #0a2559; font-size: 0.6rem; margin-right: 0.3rem; margin-top: 0.05rem;">✓</span>
                                            <div>
                                                <div style="color: #0a2559; font-weight: 600; font-size: 0.65rem; line-height: 1.2; margin-bottom: 0.15rem;">
                                                    Verify offered production
                                                </div>
                                                <div style="color: #64748b; font-size: 0.55rem; line-height: 1.2;">
                                                    Some companies inflate production to justify pricing. Make sure it's realistic.
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- Tip 3 -->
                                        <div style="display: flex; align-items: flex-start;">
                                            <span style="color: #0a2559; font-size: 0.6rem; margin-right: 0.3rem; margin-top: 0.05rem;">✓</span>
                                            <div>
                                                <div style="color: #0a2559; font-weight: 600; font-size: 0.65rem; line-height: 1.2; margin-bottom: 0.15rem;">
                                                    Confirm warranty backing
                                                </div>
                                                <div style="color: #64748b; font-size: 0.55rem; line-height: 1.2;">
                                                    A solid manufacturer provides long-term security, not just the installer.
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Connecting Message -->
                        <div style="text-align: left; margin: 1.5rem 0 0.8rem 0; padding: 0.5rem 0; max-width: 600px;">
                            <p style="color: #0a2559; font-size: 0.75rem; font-weight: 600; margin: 0; letter-spacing: 0.2px; line-height: 1.3;">
                                From our factory to your roof — backed by a Fortune 500 global leader.
                            </p>
                            <p style="color: #475569; font-size: 0.7rem; font-weight: 500; margin: 0.2rem 0 0 0; font-style: italic;">
                                One company. Zero middlemen. Total peace of mind.
                            </p>
                        </div>
                        
                        <!-- Industry Recognition Badges - Bottom Row -->
                        <div style="margin-top: 1rem; padding: 1.5rem 0; display: flex; justify-content: center; align-items: center; gap: 3rem; flex-wrap: wrap;">
                            
                            <!-- Badge 1: Best-in-class Warranty -->
                            <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                                <img src="Tesla-solar-tool_Files/25-year-warranty-badge.svg" alt="25 Year Warranty" style="width: 60px; height: 60px; margin-bottom: 0.5rem;">
                                <div style="font-size: 0.6rem; color: #0a2559; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1px; line-height: 1.2; max-width: 100px; text-align: center;">
                                    Best-in-class Warranty
                                </div>
                            </div>
                            
                            <!-- Badge 2: Tier 1 Bankability -->
                            <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                                <img src="Tesla-solar-tool_Files/fortune-500-2022-badge.svg" alt="Fortune 500" style="width: 60px; height: 60px; margin-bottom: 0.5rem;">
                                <div style="font-size: 0.6rem; color: #0a2559; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1px; line-height: 1.2; max-width: 100px; text-align: center;">
                                    Tier 1 Bankability
                                </div>
                            </div>
                            
                            <!-- Badge 3: No. 1 Market Share -->
                            <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                                <img src="Tesla-solar-tool_Files/number-1-solar-company-badge.svg" alt="#1 Solar Company" style="width: 60px; height: 60px; margin-bottom: 0.5rem;">
                                <div style="font-size: 0.6rem; color: #0a2559; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1px; line-height: 1.2; max-width: 100px; text-align: center;">
                                    No. 1 Market Share
                                </div>
                            </div>
                            
                            <!-- Badge 4: By Solar Reviews -->
                            <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                                <img src="Tesla-solar-tool_Files/number-1-solar-panel-manufacturer-badge.svg" alt="#1 Panel Manufacturer" style="width: 60px; height: 60px; margin-bottom: 0.5rem;">
                                <div style="font-size: 0.6rem; color: #0a2559; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1px; line-height: 1.2; max-width: 100px; text-align: center;">
                                    By Solar Reviews
                                </div>
                            </div>
                            
                            <!-- Badge 5: USA Panel Assembly -->
                            <div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
                                <img src="Tesla-solar-tool_Files/assembled-in-usa-badge.svg" alt="Assembled in USA" style="width: 60px; height: 60px; margin-bottom: 0.5rem;">
                                <div style="font-size: 0.6rem; color: #0a2559; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1px; line-height: 1.2; max-width: 100px; text-align: center;">
                                    USA Panel Assembly
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    <!-- Second Slide - System Comparison Analysis -->
                    <div class="slide">
                        <h2 style="color: #0a2559; font-size: 2.2rem; font-weight: 700; text-align: center; margin-bottom: 2rem;">System Comparison Analysis</h2>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; max-width: 1000px; margin: 0 auto;">
                            <!-- Competitor System -->
                            <div style="text-align: center;">
                                <h3 style="color: #dc2626; font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem;">Competitor Solar Program</h3>
                                
                                <!-- Production Display -->
                                <div style="background: #f8f8f8; padding: 1.5rem; margin-bottom: 1.5rem; border-left: 4px solid #dc2626;">
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #0a2559; margin-bottom: 0.5rem;">
                                        <span id="sunrunProductionDisplay">13,472</span>
                                    </div>
                                    <div style="font-size: 1rem; color: #6b7280; font-weight: 500;" id="productionCapacityText">
                                        kWh/year production capacity
                                    </div>
                                </div>
                                
                                <!-- Pricing Options -->
                                <div id="competitorPricingContainer">
                                    <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem; margin-bottom: 1rem;">
                                        <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                            Baseline Price (3.5% escalator)
                                        </div>
                                        <div style="font-size: 1.8rem; font-weight: 700; color: #dc2626;">
                                            $<span id="sunrunBasePriceDisplay">215.14</span>/month
                                        </div>
                                    </div>
                                    <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem;">
                                        <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                            Flex Price (3.5% escalator)
                                        </div>
                                        <div style="font-size: 1.8rem; font-weight: 700; color: #dc2626;">
                                            $<span id="sunrunFlexPriceDisplay">248.96</span>/month
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Our System -->
                            <div style="text-align: center;">
                                <h3 style="color: #0a2559; font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem;">Axia Solar Solution</h3>
                                
                                <!-- Production Display -->
                                <div style="background: #f0f5ff; padding: 1.5rem; margin-bottom: 1.5rem; border-left: 4px solid #0a2559;">
                                    <div style="font-size: 2.5rem; font-weight: 800; color: #0a2559; margin-bottom: 0.5rem;">
                                        <span id="ourProductionDisplay">12,106</span>
                                    </div>
                                    <div style="font-size: 1rem; color: #6b7280; font-weight: 500;">
                                        kWh/year optimized production
                                    </div>
                                </div>
                                
                                <!-- Pricing Options -->
                                <div>
                                    <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem; margin-bottom: 1rem;" class="escalator-plan-content">
                                        <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                            Escalated (<span id="ourEscalatorDisplay">3.5%</span>)
                                        </div>
                                        <div style="font-size: 1.8rem; font-weight: 700; color: #16a34a;">
                                            $<span id="ourPriceDisplay">195.13</span>/month
                                        </div>
                                    </div>
                                    <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem;" class="fixed-plan-option">
                                        <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                            Fixed (0%)
                                        </div>
                                        <div style="font-size: 1.8rem; font-weight: 700; color: #16a34a;">
                                            $<span id="ourFixedPriceDisplay">280.19</span>/month
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Partial vs Full Access -->
                    <div class="slide" id="partialVsFullAccessSlide">
                        <h2 style="color: #0a2559; font-size: 2.2rem; font-weight: 700; text-align: center; margin-bottom: 1.5rem;">Partial vs Full Access</h2>
                        
                        <!-- Marketing Section -->
                        <div style="text-align: left; margin-bottom: 2.5rem; max-width: 900px; margin-left: 0; margin-right: auto;" class="oversizing-message">
                            <!-- Headline -->
                            <h3 style="color: #0a2559; font-size: 1.4rem; font-weight: 600; margin-bottom: 1.2rem; line-height: 1.3;">
                                Pay only for the energy you need—nothing you don't.
                            </h3>
                            
                            <!-- Subhead -->
                            <p style="color: #374151; font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.5rem; max-width: 800px;">
                                Oversizing is paying for more panels you won't use because you don't need them. Start with a system matched to your real consumption. If you ever need more (EV, pool, remodel), we simply add panels.
                            </p>
                            
                            <!-- Footer -->
                            <div style="background: #f0f5ff; padding: 1rem 2rem; border-radius: 8px; border-left: 4px solid #0a2559; display: inline-block;">
                                <p style="color: #0a2559; font-size: 1rem; font-weight: 600; margin: 0;">
                                    Pay for what you use now. Expand when you need more.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Explanatory text -->
                        <div class="grid-layout" style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 40px; margin-bottom: 2.5rem; position: relative; max-width: 1000px; margin-left: auto; margin-right: auto;">
                            <!-- Thin divider line in the middle -->
                            <div style="position: absolute; left: 50%; top: 0; bottom: 0; width: 1px; background: #e5e7eb; transform: translateX(-50%);"></div>
                            
                            <div>
                                <h3 style="color: #dc2626; font-size: 1.5rem; font-weight: 600; margin-bottom: 1.2rem;">Competitor Program</h3>
                                <p style="color: #374151; font-size: 1.1rem; margin-bottom: 1.5rem; line-height: 1.6;">You only have full access to your <strong>baseline</strong> included in the minimum payment.</p>
                                
                                <div style="background: #f8f8f8; border-left: 4px solid #dc2626; padding: 1.2rem; margin-bottom: 1rem;">
                                    <p style="color: #374151; font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;"><span id="accessBaselineAmount">9,158</span> kWh/year - baseline included</p>
                                    <p style="color: #6b7280; margin: 0; font-size: 0.9rem;">Included in minimum payment</p>
                                </div>
                                
                                <div style="background: #f8f8f8; border-left: 4px solid #dc2626; padding: 1.2rem;">
                                    <p style="color: #374151; font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">+<span id="accessExtraAmount">4,311</span> kWh/year - charged extra with Flex rate</p>
                                    <p style="color: #6b7280; margin: 0; font-size: 0.9rem;">Additional payments if you use this energy</p>
                                </div>
                            </div>
                            
                            <div>
                                <h3 style="color: #0a2559; font-size: 1.5rem; font-weight: 600; margin-bottom: 1.2rem;">Axia by Qcells</h3>
                                <p style="color: #374151; font-size: 1.1rem; margin-bottom: 1.5rem; line-height: 1.6;">You have <strong>100% access</strong> to all production from your system from day one.</p>
                                
                                <div style="background: #f0f5ff; border-left: 4px solid #0a2559; padding: 1.2rem; margin-bottom: 1rem;">
                                    <p style="color: #374151; font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;"><span id="accessOurTotal">12,106</span> kWh/year - complete access</p>
                                    <p style="color: #6b7280; margin: 0; font-size: 0.9rem;">All production included in your monthly payment</p>
                                </div>
                                
                                <div style="background: #f0f5ff; border-left: 4px solid #059669; padding: 1.2rem;">
                                    <p style="color: #374151; font-size: 1rem; margin-bottom: 0.5rem; font-weight: 600;">No limits - no additional charges</p>
                                    <p style="color: #6b7280; margin: 0; font-size: 0.9rem;">Use your energy without restrictions</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Annual Financial Impact -->
                    <div class="slide" id="annualFinancialImpactSlide">
                        <h2 style="color: #0a2559; font-size: 2.2rem; font-weight: 700; text-align: center; margin-bottom: 2.5rem;">Annual Financial Impact</h2>
                        
                        <!-- Financial Impact -->
                        <div style="background: #fef7f0; padding: 2rem; border-radius: 12px; border: 1px solid #fb923c; margin-bottom: 2rem; max-width: 800px; margin-left: auto; margin-right: auto;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; text-align: center;">
                                <div>
                                    <p style="font-size: 1rem; color: #6b7280; margin-bottom: 1rem;">If you use extra <span id="impactExtraKwh2">3864</span> kWh:</p>
                                    <p style="font-size: 2rem; font-weight: bold; color: #dc2626; margin: 0;">+$<span id="impactExtraCost2">580</span>/year</p>
                                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.8rem;">in Flex rate charges</p>
                                </div>
                                <div>
                                    <p style="font-size: 1rem; color: #6b7280; margin-bottom: 1rem;">With Axia complete access:</p>
                                    <p style="font-size: 2rem; font-weight: bold; color: #059669; margin: 0;">$0</p>
                                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.8rem;">in additional charges</p>
                                </div>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div class="chart-container" style="margin-bottom: 2rem; height: 400px; position: relative; max-width: 900px; margin-left: auto; margin-right: auto;">
                            <canvas id="accessChart" style="width: 100%; height: 100%;"></canvas>
                        </div>

                        <!-- Legend -->
                        <div style="display: flex; justify-content: center; margin-bottom: 2rem; gap: 2rem;">
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div style="width: 24px; height: 24px; background: #1e40af; border-radius: 4px;"></div>
                                <span style="font-size: 1rem; font-weight: 500;">Baseline (included)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div style="width: 24px; height: 24px; background: #dc2626; border-radius: 4px;"></div>
                                <span style="font-size: 1rem; font-weight: 500;">Charged extra (Flex)</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.8rem;">
                                <div style="width: 24px; height: 24px; background: #059669; border-radius: 4px;"></div>
                                <span style="font-size: 1rem; font-weight: 500;">Complete access (Axia)</span>
                            </div>
                        </div>

                        <!-- Note -->
                        <div style="background: #f8fafc; padding: 1.5rem; border-left: 4px solid #6b7280; border-radius: 8px;">
                            <p style="color: #6b7280; font-size: 1rem; margin: 0; font-style: italic; text-align: center;">
                                <i class="fas fa-info-circle" style="margin-right: 8px; color: #6b7280;"></i>
                                * Both amounts subject to the contract's annual escalator. Production may vary depending on weather conditions.
                            </p>
                        </div>
                    </div>

                    <!-- Monthly Payment Comparison -->
                    <!-- Monthly Payment Evolution Analysis -->
                    <div class="slide" id="monthlyPaymentSlide">
                        <h2 style="font-size: 2rem; margin-bottom: 1.2rem;">Monthly Payment Evolution Analysis</h2>
                        
                        <!-- Chart Type Selector -->
                        <div style="text-align: center; margin-bottom: 1.2rem;">
                            <div style="display: inline-flex; background: #f1f5f9; border-radius: 8px; padding: 4px;">
                                <button id="lineChartBtn" class="chart-type-btn active" onclick="switchChartType('line')" style="padding: 6px 12px; background: #0a2559; color: white; border: none; border-radius: 6px; margin-right: 4px; cursor: pointer; font-weight: 500; font-size: 0.8rem;">Line Chart</button>
                                <button id="barChartBtn" class="chart-type-btn" onclick="switchChartType('bar')" style="padding: 6px 12px; background: transparent; color: #0a2559; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; font-size: 0.8rem;">Bar Chart</button>
                            </div>
                        </div>
                        
                        <div class="chart-container" style="height: 450px; position: relative; margin-bottom: 1.5rem; padding: 1.2rem;">
                            <canvas id="monthlyChart" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>

                    <!-- 5-25 Year Financial Impact Table -->
                    <div class="slide" id="financialImpactTableSlide">
                        <h2 style="font-size: 2rem; margin-bottom: 1.2rem; text-align: center; color: var(--primary-navy); font-weight: 700;">5-25 Year Financial Impact Analysis</h2>
                        
                        <div style="margin: 1.5rem 0;">
                            <div style="overflow-x: auto; background: white; box-shadow: 0 4px 10px -2px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(226, 232, 240, 0.8);">
                                <table style="width: 100%; border-collapse: separate; border-spacing: 0; background: white; overflow: hidden;">
                                    <thead>
                                        <tr>
                                            <th style="padding: 12px; text-align: left; font-weight: 700; background: #0a2559; color: white; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;">Year</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 700; background: #0a2559; color: white; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;" id="competitorTableHeader">Baseline Program</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 700; background: #0a2559; color: white; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;" class="fixed-plan-column">Our Solution (0% fixed)</th>
                                            <th style="padding: 12px; text-align: left; font-weight: 700; background: #0a2559; color: white; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;" class="escalator-plan-content">Our Solution (<span id="impactEscalatorHeader">3.5%</span> escalator)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid #e5e7eb;">
                                            <td style="padding: 14px 16px; font-weight: 700; background: #f8fafc; font-size: 0.9rem; color: #1e3a8a;">Year 1</td>
                                            <td style="padding: 14px 16px; background: #f8f8f8;">
                                                <div style="font-size: 1rem; font-weight: 700; margin-bottom: 4px; color: #0a2559;">$<span id="impactFlexYear1">248.96</span>/month <span class="flex-only-text" style="font-size: 0.75rem; color: #dc2626; font-weight: 500;">(minimum)</span></div>
                                                <div class="flex-only-text" style="font-size: 0.75rem; color: #6b7280;">Up to $<span id="impactFlexYear1Max">248.96</span> with Flex Rate</div>
                                            </td>
                                            <td style="padding: 14px 16px; background: #f8f8f8;" class="fixed-plan-column">
                                                <div style="font-size: 1rem; font-weight: 700; margin-bottom: 4px; color: #0a2559;">$<span id="impactFixedYear1">280.19</span>/month</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">Guaranteed fixed price</div>
                                            </td>
                                            <td style="padding: 14px 16px; background: #f8f8f8;" class="escalator-plan-content">
                                                <div style="font-size: 1rem; font-weight: 700; margin-bottom: 4px; color: #0a2559;">$<span id="impactEscalatedYear1">195.13</span>/month</div>
                                                <div style="font-size: 0.75rem; color: #6b7280;">Lower starting price</div>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #e5e7eb;">
                                            <td style="padding: 20px 24px; background: #f8f8f8; font-weight: 700;  font-size: 1.1rem; color: #1e3a8a;">Year 5</td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #0a2559;">$<span id="impactFlexYear5">291.80</span>/month <span class="flex-only-text" style="font-size: 0.9rem; color: #dc2626; font-weight: 500;">(minimum)</span></div>
                                                <div class="flex-only-text" style="font-size: 0.9rem; color: #6b7280;">Up to $<span id="impactFlexYear5Max">291.80</span> with Flex Rate</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="fixed-plan-column">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #0a2559;">$<span id="impactFixedYear5">280.19</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;">No changes</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="escalator-plan-content">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #0a2559;">$<span id="impactEscalatedYear5">229.73</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;">Gradual increase</div>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #e5e7eb;">
                                            <td style="padding: 20px 24px; background: #f8f8f8; font-weight: 700;  font-size: 1.1rem; color: #1e3a8a;">Year 10</td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactFlexYear10">353.84</span>/month <span class="flex-only-text" style="font-size: 0.9rem; color: #dc2626; font-weight: 500;">(minimum)</span></div>
                                                <div class="flex-only-text" style="font-size: 0.9rem; color: #6b7280;">Up to $<span id="impactFlexYear10Max">353.84</span> with Flex Rate</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="fixed-plan-column">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactFixedYear10">280.19</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;">No changes</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="escalator-plan-content">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactEscalatedYear10">279.44</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;" id="escalatedYear10Description">Still below Flex maximum</div>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #e5e7eb;">
                                            <td style="padding: 20px 24px; background: #f8f8f8; font-weight: 700;  font-size: 1.1rem; color: #1e3a8a;">Year 15</td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactFlexYear15">501.97</span>/month <span class="flex-only-text" style="font-size: 0.9rem; color: #dc2626; font-weight: 500;">(minimum)</span></div>
                                                <div class="flex-only-text" style="font-size: 0.9rem; color: #6b7280;">Up to $<span id="impactFlexYear15Max">501.97</span> with Flex Rate</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="fixed-plan-column">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactFixedYear15">280.19</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;">No changes</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="escalator-plan-content">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactEscalatedYear15">391.59</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;">Still competitive</div>
                                            </td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #e5e7eb;">
                                            <td style="padding: 20px 24px; background: #f8f8f8; font-weight: 700;  font-size: 1.1rem; color: #1e3a8a;">Year 25</td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactFlexYear25">1,010.62</span>/month <span class="flex-only-text" style="font-size: 0.9rem; color: #dc2626; font-weight: 500;">(minimum)</span></div>
                                                <div class="flex-only-text" style="font-size: 0.9rem; color: #6b7280;">Up to $<span id="impactFlexYear25Max">1,010.62</span> with Flex Rate</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="fixed-plan-column">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactFixedYear25">280.19</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;">No changes</div>
                                            </td>
                                            <td style="padding: 20px 24px; background: #f8f8f8;" class="escalator-plan-content">
                                                <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 6px; color: #1f2937;">$<span id="impactEscalatedYear25">767.07</span>/month</div>
                                                <div style="font-size: 0.9rem; color: #6b7280;" id="escalatedYear25Description">Still much lower than Flex</div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 24px; font-weight: 700; color: #1e3a8a; font-size: 1.1rem;">25-year total</td>
                                            <td style="padding: 24px;">
                                                <div style="font-size: 1.4rem; font-weight: 800; color: #0a2559; margin-bottom: 6px;">$<span id="impactBaseline25Total">175,847</span> <span class="flex-only-text" style="font-size: 0.9rem; color: #dc2626; font-weight: 500;">(minimum)</span></div>
                                                <div class="flex-only-text" style="font-size: 0.9rem; color: #dc2626;">Could be higher with Flex Rate charges</div>
                                            </td>
                                            <td style="padding: 24px; " class="fixed-plan-column">
                                                <div style="font-size: 1.4rem; font-weight: 800; color: #0a2559; margin-bottom: 6px;">$<span id="impactFixed25Total">84,057</span></div>
                                                <div class="flex-only-text" style="font-size: 1rem; color: #16a34a; font-weight: 600;">Savings vs. Flex: $<span id="impactFixed25Savings">91,790</span></div>
                                                <div class="competitor-savings" style="font-size: 1rem; color: #16a34a; font-weight: 600; display: none;">Savings vs. Competitor: $<span id="impactFixed25CompetitorSavings">16,499</span></div>
                                            </td>
                                            <td style="padding: 24px;" class="escalator-plan-content">
                                                <div style="font-size: 1.4rem; font-weight: 800; color: #0a2559; margin-bottom: 6px;">$<span id="impactEscalated25Total">126,872</span></div>
                                                <div class="flex-only-text" style="font-size: 1rem; color: #16a34a; font-weight: 600;">Savings vs. Flex: $<span id="impactEscalated25Savings">48,975</span></div>
                                                <div class="competitor-savings" style="font-size: 1rem; color: #16a34a; font-weight: 600; display: none;">Savings vs. Competitor: $<span id="impactEscalated25CompetitorSavings">9,353</span></div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 1.5rem; padding: 1.5rem; border-left: 4px solid #3b82f6;">
                                <p style="font-size: 0.9rem; color: #6b7280; margin: 0; font-style: italic;">
                                    <i class="fas fa-info-circle" style="margin-right: 10px; color: #3b82f6;"></i>
                                    These are estimated values. We perform a personalized analysis based on your actual consumption and specific conditions. Savings may vary.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Your Savings -->
                    <div class="slide" id="yourPotentialSavingsSlide">
                        <h2 id="savingsTitle">Your Potential Savings</h2>
                        <div class="savings-highlight" id="savingsHighlight">
                            <!-- Savings data will be generated by JavaScript -->
                        </div>
                        <div class="chart-container" id="savingsChartContainer" style="height: 400px; position: relative;">
                            <canvas id="savingsChart" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>

                    <!-- Fixed Plan Savings -->
                    <div class="slide fixed-plan-savings" id="fixedPlanSavingsSlide">
                        <div class="savings-highlight" id="fixedSavingsHighlight">
                            <!-- Fixed plan savings data will be generated by JavaScript -->
                        </div>
                        <div class="chart-container fixed-plan-savings" style="height: 400px; position: relative;">
                            <canvas id="fixedSavingsChart" style="width: 100%; height: 100%;"></canvas>
                        </div>
                    </div>

                    <!-- Comparison Table -->
                    <div class="slide" id="comparisonTableSlide">
                        <h2 id="comparisonTableTitle">Complete Comparison: Flex Program vs Our Solar Solution</h2>
                        
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: separate; border-spacing: 0; background: white; overflow: hidden; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(226, 232, 240, 0.8);">
                                <thead>
                                    <tr style="background: #0a2559;">
                                        <th style="padding: 20px 24px; background: #f8f8f8; text-align: left; font-weight: 700; color: white; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border: none; background: #0a2559;">Feature</th>
                                        <th style="padding: 20px 24px; background: #f8f8f8; text-align: left; font-weight: 700; color: white; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border: none; background: #0a2559;" id="comparisonTableCompetitorHeader">Flex Program</th>
                                        <th style="padding: 20px 24px; background: #f8f8f8; text-align: left; font-weight: 700; color: white; font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.05em; border: none; background: #0a2559;">Our Solar Solution</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9; font-weight: 600;">Energy Access</td>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9;" id="energyAccessCell">
                                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                                <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                                                <span>Limited baseline access</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: #6b7280;"><span id="comparisonBaselineDisplay">9,605</span> kWh/year included, extra charged separately</div>
                                        </td>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9; ">
                                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                                <i class="fas fa-check" style="color: #16a34a; margin-right: 8px;"></i>
                                                <span>100% Complete Access</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">All production included in your monthly payment</div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9; font-weight: 600;">Escalator</td>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9;" id="escalatorCell">
                                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                                <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                                                <span>Mandatory 3.5% annual</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">No fixed payment option</div>
                                        </td>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9; ">
                                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                                <i class="fas fa-check" style="color: #16a34a; margin-right: 8px;"></i>
                                                <span>Flexible options</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Optional <span id="comparisonEscalatorDisplay">3.5%</span> escalator<span class="fixed-plan-option"> or fixed payment (0%)</span></div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9; font-weight: 600;">System Sizing</td>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9;" id="systemSizingCell">
                                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                                <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                                                <span>Oversized</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Systems <span id="comparisonOversizedDisplay">141%</span> larger than your actual consumption</div>
                                        </td>
                                        <td style="padding: 18px 24px; border-bottom: 1px solid #f1f5f9; ">
                                            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                                                <i class="fas fa-check" style="color: #16a34a; margin-right: 8px;"></i>
                                                <span>Exact design</span>
                                            </div>
                                            <div style="font-size: 0.875rem; color: #6b7280;">Customized to your actual needs</div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 18px 24px; font-weight: 600;">Monthly Payment Range</td>
                                        <td style="padding: 18px 24px; " id="competitorPaymentCell">
                                            <div style="font-size: 1.125rem; font-weight: 600;">$<span id="comparisonFlexMinDisplay">215.14</span> - $<span id="comparisonFlexMaxDisplay">248.96</span></div>
                                            <div style="font-size: 0.875rem; color: #6b7280;" id="competitorPaymentDescription">Always increases 3.5% annually</div>
                                        </td>
                                        <td style="padding: 18px 24px; ">
                                            <div style="font-size: 1.125rem; font-weight: 600;">$<span id="comparisonOurPriceDisplay">195.13</span> - $<span id="comparisonOurFixedDisplay">280.19</span></div>
                                            <div style="font-size: 0.875rem; color: #6b7280;" id="ourPaymentOptionsDescription">Choose <span id="comparisonOurEscalatorDisplay">3.5%</span> escalator or fixed payment (0%)</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recommendation -->
                    <div class="slide">
                        <h2>Our Recommendation</h2>
                        <div class="recommendation-content" id="recommendationContent">
                            <!-- Recommendation will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Generate PDF using native browser functionality
        function printProposal() {
            console.log('🖨️ Starting native PDF generation...');
            
            try {
                // Hide control panel and menu elements
                const controlPanel = document.querySelector('.control-panel');
                const menuToggle = document.querySelector('.menu-toggle');
                
                if (controlPanel) {
                    controlPanel.style.display = 'none';
                }
                if (menuToggle) {
                    menuToggle.style.display = 'none';
                }
                
                // Hide image upload overlays and notifications
                const overlays = document.querySelectorAll('.image-upload-overlay');
                const notifications = document.querySelectorAll('.notification, [class*="notification"]');
                
                overlays.forEach(overlay => {
                    overlay.style.display = 'none';
                });
                
                notifications.forEach(notification => {
                    notification.style.display = 'none';
                });
                
                // Remove contenteditable styling for cleaner print
                const editableElements = document.querySelectorAll('[contenteditable="true"]');
                editableElements.forEach(element => {
                    element.style.background = 'transparent';
                    element.style.boxShadow = 'none';
                    element.style.border = 'none';
                    element.style.outline = 'none';
                });
                
                // Wait a moment for UI changes to take effect
                setTimeout(() => {
                    console.log('🖨️ Opening browser print dialog...');
                    
                    // Trigger native browser print immediately without notification
                    window.print();
                    
                    // Restore UI after print dialog
                    setTimeout(() => {
                        console.log('✅ Restoring UI elements...');
                        
                        // Restore control panel and menu
                        if (controlPanel) {
                            controlPanel.style.display = '';
                        }
                        if (menuToggle) {
                            menuToggle.style.display = '';
                        }
                        
                        // Restore overlays
                        overlays.forEach(overlay => {
                            overlay.style.display = '';
                        });
                        
                        // Restore notifications
                        notifications.forEach(notification => {
                            notification.style.display = '';
                        });
                        
                        // Restore editable styling
                        editableElements.forEach(element => {
                            element.style.background = '';
                            element.style.boxShadow = '';
                            element.style.border = '';
                            element.style.outline = '';
                        });
                        
                    }, 1000);
                    
                }, 300);
                
            } catch (error) {
                console.error('❌ PDF generation error:', error);
            }
        }
        
        // Toggle control panel visibility
        function toggleControlPanel() {
            const controlPanel = document.querySelector('.control-panel');
            const menuToggle = document.querySelector('.menu-toggle');
            
            if (controlPanel.classList.contains('show')) {
                controlPanel.classList.remove('show');
                menuToggle.classList.remove('active');
            } else {
                controlPanel.classList.add('show');
                menuToggle.classList.add('active');
            }
        }

        // Close control panel when clicking outside
        document.addEventListener('click', function(event) {
            const controlPanel = document.querySelector('.control-panel');
            const menuToggle = document.querySelector('.menu-toggle');
            
            // If control panel is open and click is outside both panel and toggle button
            if (controlPanel.classList.contains('show')) {
                if (!controlPanel.contains(event.target) && !menuToggle.contains(event.target)) {
                    controlPanel.classList.remove('show');
                    menuToggle.classList.remove('active');
                }
            }
        });
        
        // Helper function for 25-year total calculation
        function calculateTotal25Years(monthlyPayment, escalatorRate) {
            let total = 0;
            let currentPayment = monthlyPayment;
            
            for (let year = 1; year <= 25; year++) {
                total += currentPayment * 12;
                currentPayment *= (1 + escalatorRate / 100);
            }
            
            return Math.round(total);
        }
        
        // Helper function for projected savings calculation
        function calculateProjectedSavings(years, theirPrice, ourPrice, theirEscalator, ourEscalator) {
            let totalSavings = 0;
            let theirCurrentPrice = theirPrice;
            let ourCurrentPrice = ourPrice;
            
            for (let year = 1; year <= years; year++) {
                totalSavings += (theirCurrentPrice - ourCurrentPrice) * 12;
                theirCurrentPrice *= (1 + theirEscalator / 100);
                ourCurrentPrice *= (1 + ourEscalator / 100);
            }
            
            return totalSavings;
        }

        // Existing functions continue below...
        // Data storage
        let presentationData = {
            clientName: 'Valued Customer',
            competitorType: 'flex', // 'flex' or 'other'
            // Flex Program data
            sunrunBaseProduction: 13469,
            sunrunFlexProduction: 19000,
            sunrunProduction: 13472, // Keep for backward compatibility
            sunrunBasePrice: 215.14,
            sunrunFlexPrice: 248.96,
            sunrunEscalator: 3.5,
            // Other Competitor data
            competitorProduction: 13469,
            competitorPrice: 215.14,
            competitorEscalator: 3.5,
            // Axia data
            ourProduction: 12106,
            ourEscalator: 3.5,
            ourPrice: 195.13,
            ourFixedPrice: 280.19,
            zeroInterestAvailable: true, // Controls if 0% financing should be included
            showOversizedMessage: true, // Controls if oversizing message should be shown
            // Direct baseline value - updated from panel, not calculated
            baselineUsage: 9605,
            // Calculated values
            get usage() { return this.ourProduction; },
            get systemSize() { return this.sunrunProduction; },
            get baselinePrice() { return this.sunrunBasePrice; },
            get flexPrice() { return this.sunrunFlexPrice; }
        };

        // Chart variables
        let monthlyChart, savingsChart, fixedSavingsChart, accessChart;
        let currentChartType = 'line'; // Track current chart type

        // Update display values
        function updateDisplayValues() {
            // Show "?" if competitor production is 0 (no data available)
            const productionDisplay = document.getElementById('sunrunProductionDisplay');
            const productionText = document.getElementById('productionCapacityText');
            
            if (presentationData.sunrunProduction === 0) {
                productionDisplay.textContent = '?';
                productionDisplay.style.fontSize = '3rem'; // Make question mark slightly larger
                productionText.textContent = 'Production data not available';
            } else {
                productionDisplay.textContent = presentationData.sunrunProduction.toLocaleString('en-US');
                productionDisplay.style.fontSize = '2.5rem'; // Reset to normal size
                productionText.textContent = 'kWh/year production capacity';
            }
            
            // Update competitor pricing based on type
            const competitorType = presentationData.competitorType || 'flex';
            if (competitorType === 'flex') {
                // Update Flex Program prices (if elements exist)
                const basePriceElement = document.getElementById('sunrunBasePriceDisplay');
                const flexPriceElement = document.getElementById('sunrunFlexPriceDisplay');
                if (basePriceElement) basePriceElement.textContent = presentationData.sunrunBasePrice.toFixed(2);
                if (flexPriceElement) flexPriceElement.textContent = presentationData.sunrunFlexPrice.toFixed(2);
            } else {
                // Update Another Competitor price (if element exists)
                const competitorPriceElement = document.getElementById('competitorPriceDisplay');
                const competitorEscalatorElement = document.getElementById('competitorEscalatorDisplay');
                if (competitorPriceElement) competitorPriceElement.textContent = presentationData.competitorPrice.toFixed(2);
                if (competitorEscalatorElement) competitorEscalatorElement.textContent = presentationData.competitorEscalator;
            }
            
            document.getElementById('ourProductionDisplay').textContent = presentationData.ourProduction.toLocaleString('en-US');
            document.getElementById('ourEscalatorDisplay').textContent = presentationData.ourEscalator;
            
            // Get current values from inputs for display
            const currentOurPrice = parseFloat(document.getElementById('ourPriceInput').value) || presentationData.ourPrice;
            const currentOurFixedPrice = parseFloat(document.getElementById('ourFixedPriceInput').value) || presentationData.ourFixedPrice;
            
            document.getElementById('ourPriceDisplay').textContent = currentOurPrice.toFixed(2);
            document.getElementById('ourFixedPriceDisplay').textContent = currentOurFixedPrice.toFixed(2);
        }

        // Update Analysis function - triggered by button (now removed)
        function updateAnalysis() {
            // This function is kept for compatibility but not used since the main panel is removed
            updateAll();
        }

        // Calculate costs over 25 years
        function calculateCosts() {
            const years = 25;
            const baselineProgram = [];
            const flexProgram = [];
            const competitor = [];
            const ourEscalated = [];
            const ourFixed = [];
            
            // Get current values from inputs (more reliable than presentationData)
            const currentOurPrice = parseFloat(document.getElementById('ourPriceInput').value) || presentationData.ourPrice;
            const currentOurFixedPrice = parseFloat(document.getElementById('ourFixedPriceInput').value) || presentationData.ourFixedPrice;
            const currentOurEscalator = document.getElementById('ourEscalatorInput').value === 'none' ? 0 : 
                (parseFloat(document.getElementById('ourEscalatorInput').value) || presentationData.ourEscalator);
            
            for (let year = 1; year <= years; year++) {
                if (presentationData.competitorType === 'flex') {
                    const programEscalator = presentationData.sunrunEscalator || 3.5;
                    
                    // Baseline Program with escalator
                    let baselineProgramTotal = 0;
                    for (let y = 1; y <= year; y++) {
                        baselineProgramTotal += presentationData.baselinePrice * Math.pow(1 + programEscalator / 100, y - 1) * 12;
                    }
                    baselineProgram.push(baselineProgramTotal);
                    
                    // Flex Program with escalator
                    let flexProgramTotal = 0;
                    for (let y = 1; y <= year; y++) {
                        flexProgramTotal += presentationData.flexPrice * Math.pow(1 + programEscalator / 100, y - 1) * 12;
                    }
                    flexProgram.push(flexProgramTotal);
                } else {
                    // Other Competitor calculation
                    const competitorEscalator = presentationData.competitorEscalator || 3.5;
                    let competitorTotal = 0;
                    for (let y = 1; y <= year; y++) {
                        competitorTotal += presentationData.competitorPrice * Math.pow(1 + competitorEscalator / 100, y - 1) * 12;
                    }
                    competitor.push(competitorTotal);
                    
                    // For compatibility, also populate baseline/flex with competitor data
                    baselineProgram.push(competitorTotal);
                    flexProgram.push(competitorTotal);
                }
                
                // Calculate our escalated payments
                let escalatedTotal = 0;
                for (let y = 1; y <= year; y++) {
                    escalatedTotal += currentOurPrice * Math.pow(1 + currentOurEscalator / 100, y - 1) * 12;
                }
                ourEscalated.push(escalatedTotal);
                
                // Our fixed payments
                ourFixed.push(currentOurFixedPrice * 12 * year);
            }
            
            return { baselineProgram, flexProgram, competitor, ourEscalated, ourFixed };
        }

        // Create monthly payment chart
        function createMonthlyChart() {
            try {
                console.log('Creating monthly chart...');
                console.log('Current escalator state:', {
                    escalatorAvailable: presentationData.escalatorAvailable,
                    ourEscalator: presentationData.ourEscalator
                });
                
                const ctx = document.getElementById('monthlyChart').getContext('2d');
                const years = [1, 3, 5, 10, 15, 18, 20, 25];
                
                // Force destroy existing chart completely
                if (monthlyChart) {
                    monthlyChart.destroy();
                    monthlyChart = null;
                }
                
                // Clear the canvas
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

                let datasets = [];
                
                if (presentationData.competitorType === 'flex') {
                    // Flex Program charts
                    const programEscalator = presentationData.sunrunEscalator || 3.5;
                    const monthlyPayments = years.map(year => {
                        return {
                            baselineProgram: presentationData.baselinePrice * Math.pow(1 + programEscalator / 100, year - 1),
                            flexProgram: presentationData.flexPrice * Math.pow(1 + programEscalator / 100, year - 1),
                            ourEscalated: presentationData.ourPrice * Math.pow(1 + presentationData.ourEscalator / 100, year - 1),
                            ourFixed: presentationData.ourFixedPrice
                        };
                    });

                    // Add competitor datasets
                    datasets.push(
                        {
                            label: `Baseline Program (${programEscalator}% escalator)`,
                            data: monthlyPayments.map(p => p.baselineProgram),
                            backgroundColor: currentChartType === 'bar' ? '#dc2626' : 'rgba(220, 38, 38, 0.15)',
                            borderColor: '#dc2626',
                            borderWidth: currentChartType === 'line' ? 4 : 1,
                            fill: currentChartType === 'line' ? false : true,
                            tension: currentChartType === 'line' ? 0 : 0
                        },
                        {
                            label: `Flex Program (${programEscalator}% escalator)`,
                            data: monthlyPayments.map(p => p.flexProgram),
                            backgroundColor: currentChartType === 'bar' ? '#b91c1c' : 'rgba(185, 28, 28, 0.15)',
                            borderColor: '#b91c1c',
                            borderWidth: currentChartType === 'line' ? 4 : 1,
                            fill: currentChartType === 'line' ? false : true,
                            tension: currentChartType === 'line' ? 0 : 0
                        }
                    );

                    // Add our escalated plan only if escalator is available
                    console.log('Checking escalator availability for chart (Flex):', {
                        escalatorAvailable: presentationData.escalatorAvailable,
                        ourEscalator: presentationData.ourEscalator
                    });
                    
                    if (presentationData.escalatorAvailable) {
                        console.log('Adding escalated plan to chart (Flex)');
                        datasets.push({
                            label: `Our Escalated (${presentationData.ourEscalator}%)`,
                            data: monthlyPayments.map(p => p.ourEscalated),
                            backgroundColor: currentChartType === 'bar' ? '#16a34a' : 'rgba(22, 163, 74, 0.15)',
                            borderColor: '#16a34a',
                            borderWidth: currentChartType === 'line' ? 4 : 1,
                            fill: currentChartType === 'line' ? false : true,
                            tension: currentChartType === 'line' ? 0 : 0
                        });
                    } else {
                        console.log('Escalator not available, skipping escalated plan (Flex)');
                    }

                    // Add fixed payment option only if 0% interest is available
                    if (presentationData.zeroInterestAvailable) {
                        datasets.push({
                            label: 'Our Fixed (0%)',
                            data: monthlyPayments.map(p => p.ourFixed),
                            backgroundColor: currentChartType === 'bar' ? '#10b981' : 'rgba(16, 185, 129, 0.15)',
                            borderColor: '#10b981',
                            borderWidth: currentChartType === 'line' ? 4 : 1,
                            fill: currentChartType === 'line' ? false : true,
                            tension: currentChartType === 'line' ? 0 : 0
                        });
                    }
                } else {
                    // Other Competitor charts
                    console.log('Creating Other Competitor chart - escalatorAvailable:', presentationData.escalatorAvailable);
                    const competitorEscalator = presentationData.competitorEscalator || 3.5;
                    const monthlyPayments = years.map(year => {
                        return {
                            competitor: presentationData.competitorPrice * Math.pow(1 + competitorEscalator / 100, year - 1),
                            ourEscalated: presentationData.ourPrice * Math.pow(1 + presentationData.ourEscalator / 100, year - 1),
                            ourFixed: presentationData.ourFixedPrice
                        };
                    });

                    // Add competitor dataset
                    datasets.push({
                        label: `Competitor (${competitorEscalator}% escalator)`,
                        data: monthlyPayments.map(p => p.competitor),
                        backgroundColor: currentChartType === 'bar' ? '#dc2626' : 'rgba(220, 38, 38, 0.15)',
                        borderColor: '#dc2626',
                        borderWidth: currentChartType === 'line' ? 4 : 1,
                        fill: currentChartType === 'line' ? false : true,
                        tension: currentChartType === 'line' ? 0 : 0
                    });

                    // Add our escalated plan only if escalator is available
                    if (presentationData.escalatorAvailable) {
                        datasets.push({
                            label: `Our Escalated (${presentationData.ourEscalator}%)`,
                            data: monthlyPayments.map(p => p.ourEscalated),
                            backgroundColor: currentChartType === 'bar' ? '#16a34a' : 'rgba(22, 163, 74, 0.15)',
                            borderColor: '#16a34a',
                            borderWidth: currentChartType === 'line' ? 4 : 1,
                            fill: currentChartType === 'line' ? false : true,
                            tension: currentChartType === 'line' ? 0 : 0
                        });
                    }

                    // Add fixed payment option only if 0% interest is available
                    if (presentationData.zeroInterestAvailable) {
                        datasets.push({
                            label: 'Our Fixed (0%)',
                            data: monthlyPayments.map(p => p.ourFixed),
                            backgroundColor: currentChartType === 'bar' ? '#10b981' : 'rgba(16, 185, 129, 0.15)',
                            borderColor: '#10b981',
                            borderWidth: currentChartType === 'line' ? 4 : 1,
                            fill: currentChartType === 'line' ? false : true,
                            tension: currentChartType === 'line' ? 0 : 0
                        });
                    }
                }

                monthlyChart = new Chart(ctx, {
                    type: currentChartType,
                    data: {
                        labels: years.map(y => `Year ${y}`),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: currentChartType === 'bar' ? 'Monthly Payment Comparison (with escalators)' : 'Monthly Payment Evolution Over Time',
                                font: {
                                    size: 20,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: currentChartType === 'line',
                                    padding: 20,
                                    font: {
                                        size: 16
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    display: currentChartType === 'line',
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.1)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(0);
                                    },
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        },
                        elements: {
                            point: {
                                radius: currentChartType === 'line' ? 5 : 0,
                                hoverRadius: currentChartType === 'line' ? 8 : 0,
                                borderWidth: currentChartType === 'line' ? 2 : 0
                            },
                            line: {
                                tension: currentChartType === 'line' ? 0 : 0
                            }
                        },
                        interaction: {
                            intersect: true,
                            mode: 'point'
                        }
                    }
                });

                // Chart creation completed
            } catch (error) {
                console.error('Error creating monthly chart:', error);
            }
        }

        // Switch chart type function
        function switchChartType(type) {
            currentChartType = type;
            
            // Update button styles
            const barBtn = document.getElementById('barChartBtn');
            const lineBtn = document.getElementById('lineChartBtn');
            
            if (type === 'bar') {
                barBtn.classList.add('active');
                lineBtn.classList.remove('active');
            } else {
                lineBtn.classList.add('active');
                barBtn.classList.remove('active');
            }
            
            // Recreate the chart with new type
            createMonthlyChart();
        }

        // Update total cost table
        function updateTotalCostTable() {
            const costs = calculateCosts();
            const tbody = document.getElementById('totalCostTableBody');
            const programEscalator = 3.5;
            tbody.innerHTML = '';
            
            // Get current values from inputs
            const currentFlexPrice = parseFloat(document.getElementById('sunrunFlexPriceInput').value) || presentationData.sunrunFlexPrice || 248.96;
            const currentBasePrice = parseFloat(document.getElementById('sunrunBasePriceInput').value) || presentationData.sunrunBasePrice || 215.14;
            const currentOurPrice = parseFloat(document.getElementById('ourPriceInput').value) || presentationData.ourPrice;
            const currentOurFixedPrice = parseFloat(document.getElementById('ourFixedPriceInput').value) || presentationData.ourFixedPrice;
            
            const programs = [
                {
                    name: 'Baseline Program (3.5% escalator)',
                    startPayment: currentBasePrice,
                    endPayment: currentBasePrice * Math.pow(1 + programEscalator / 100, 24),
                    totalCost: costs.baselineProgram[24],
                    savings: 0,
                    bgColor: 'rgba(220, 38, 38, 0.1)',
                    textColor: '#dc2626'
                },
                {
                    name: 'Flex Program (3.5% escalator)',
                    startPayment: currentFlexPrice,
                    endPayment: currentFlexPrice * Math.pow(1 + programEscalator / 100, 24),
                    totalCost: costs.flexProgram[24],
                    savings: (currentFlexPrice - currentOurFixedPrice) * 12 * 25, // Simple difference calculation: monthly difference × 12 × 25 years
                    bgColor: 'rgba(185, 28, 28, 0.1)',
                    textColor: '#b91c1c'
                },
                {
                    name: 'Our Escalated (' + presentationData.ourEscalator + '%)',
                    startPayment: currentOurPrice,
                    endPayment: currentOurPrice * Math.pow(1 + presentationData.ourEscalator / 100, 24),
                    totalCost: costs.ourEscalated[24],
                    savings: (currentOurPrice - currentFlexPrice) * 12 * 25, // Simple difference vs Flex Program
                    bgColor: 'rgba(5, 150, 105, 0.1)',
                    textColor: '#16a34a'
                },
                {
                    name: 'Our Fixed (0%)',
                    startPayment: currentOurFixedPrice,
                    endPayment: currentOurFixedPrice,
                    totalCost: costs.ourFixed[24],
                    savings: (currentOurFixedPrice - currentFlexPrice) * 12 * 25, // Simple difference vs Flex Program  
                    bgColor: 'rgba(16, 185, 129, 0.1)',
                    textColor: '#10b981'
                }
            ];

            programs.forEach(program => {
                const row = tbody.insertRow();
                row.style.background = program.bgColor;
                
                const savingsText = program.savings > 0 ? 
                    `$${program.savings.toLocaleString('en-US')} saved` : 
                    program.savings === 0 ? 'Baseline' : 
                    `$${Math.abs(program.savings).toLocaleString('en-US')} more`;
                
                const savingsColor = program.savings > 0 ? '#16a34a' : 
                                   program.savings === 0 ? '#6b7280' : '#dc2626';

                row.innerHTML = `
                    <td style="padding: 1rem; font-weight: 600; color: ${program.textColor};">${program.name}</td>
                    <td style="padding: 1rem; text-align: center;">$${program.startPayment.toFixed(2)}</td>
                    <td style="padding: 1rem; text-align: center;">$${program.endPayment.toFixed(2)}</td>
                    <td style="padding: 1rem; text-align: center; font-weight: 600;">$${program.totalCost.toLocaleString('en-US')}</td>
                    <td style="padding: 1rem; text-align: center; font-weight: 600; color: ${savingsColor};">${savingsText}</td>
                `;
            });
        }

        // Create savings chart
        function createSavingsChart() {
            const ctx = document.getElementById('savingsChart').getContext('2d');
            const costs = calculateCosts();
            const years = Array.from({length: 25}, (_, i) => i + 1);
            
            if (savingsChart) savingsChart.destroy();

            let datasets = [];
            
            if (presentationData.competitorType === 'flex') {
                // Flex Program savings charts
                if (presentationData.escalatorAvailable) {
                    // Show escalator plan lines
                    const savingsVsBaselineProgram = costs.baselineProgram.map((cost, i) => cost - costs.ourEscalated[i]);
                    const savingsVsFlexProgram = costs.flexProgram.map((cost, i) => cost - costs.ourEscalated[i]);

                    datasets.push(
                        {
                            label: `Savings vs Baseline Program (with our ${presentationData.ourEscalator}% plan)`,
                            data: savingsVsBaselineProgram,
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(5, 150, 105, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: `Savings vs Flex Program (with our ${presentationData.ourEscalator}% plan)`,
                            data: savingsVsFlexProgram,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }
                    );
                } else {
                    // Show fixed plan lines when escalator not available
                    const savingsVsBaselineProgramFixed = costs.baselineProgram.map((cost, i) => cost - costs.ourFixed[i]);
                    const savingsVsFlexProgramFixed = costs.flexProgram.map((cost, i) => cost - costs.ourFixed[i]);

                    datasets.push(
                        {
                            label: `Savings vs Baseline Program (with our fixed plan)`,
                            data: savingsVsBaselineProgramFixed,
                            borderColor: '#16a34a',
                            backgroundColor: 'rgba(5, 150, 105, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: `Savings vs Flex Program (with our fixed plan)`,
                            data: savingsVsFlexProgramFixed,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }
                    );
                }
                
                // Fixed plan lines removed - shown in separate chart below
            } else {
                // Other Competitor savings charts (escalated and conditional fixed)
                if (presentationData.escalatorAvailable) {
                    // Show escalator plan line
                    const savingsVsCompetitorEscalated = costs.competitor ? costs.competitor.map((cost, i) => cost - costs.ourEscalated[i]) : 
                        costs.baselineProgram.map((cost, i) => cost - costs.ourEscalated[i]);

                    datasets.push({
                        label: `Savings vs Competitor (with our ${presentationData.ourEscalator}% escalated plan)`,
                        data: savingsVsCompetitorEscalated,
                        borderColor: '#16a34a',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        tension: 0.4
                    });
                } else {
                    // Show fixed plan line when escalator not available
                    const savingsVsCompetitorFixed = costs.competitor ? costs.competitor.map((cost, i) => cost - costs.ourFixed[i]) : 
                        costs.baselineProgram.map((cost, i) => cost - costs.ourFixed[i]);

                    datasets.push({
                        label: `Savings vs Competitor (with our fixed plan)`,
                        data: savingsVsCompetitorFixed,
                        borderColor: '#16a34a',
                        backgroundColor: 'rgba(5, 150, 105, 0.1)',
                        tension: 0.4
                    });
                }

                // Add fixed plan savings only if 0% interest is available AND escalator is available
                if (presentationData.zeroInterestAvailable && presentationData.escalatorAvailable) {
                    const savingsVsCompetitorFixed = costs.competitor ? costs.competitor.map((cost, i) => cost - costs.ourFixed[i]) : 
                        costs.baselineProgram.map((cost, i) => cost - costs.ourFixed[i]);

                    datasets.push({
                        label: `Savings vs Competitor (with our 0% fixed plan)`,
                        data: savingsVsCompetitorFixed,
                        borderColor: '#7c3aed',
                        backgroundColor: 'rgba(124, 58, 237, 0.1)',
                        tension: 0.4
                    });
                }
            }

            savingsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: false, // Remove chart title
                            text: (() => {
                                if (presentationData.competitorType === 'flex') {
                                    if (!presentationData.escalatorAvailable) {
                                        return 'Cumulative Savings with Our Fixed Payment Plan';
                                    } else {
                                        return `Cumulative Savings with Our ${presentationData.ourEscalator}% Escalator Plan`;
                                    }
                                } else {
                                    return 'Your Potential Savings vs Competitor';
                                }
                            })(),
                            font: {
                                size: 20,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                font: {
                                    size: 16
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString('en-US');
                                },
                                font: {
                                    size: 14
                                }
                            }
                        }
                    }
                }
            });

            // Update savings highlight
            if (presentationData.competitorType === 'flex') {
                const savingsVsBaselineProgram = costs.baselineProgram.map((cost, i) => cost - costs.ourEscalated[i]);
                const savingsVsFlexProgram = costs.flexProgram.map((cost, i) => cost - costs.ourEscalated[i]);
                updateSavingsHighlight(savingsVsBaselineProgram[24], savingsVsFlexProgram[24]);
            } else {
                const savingsVsCompetitorEscalated = costs.competitor ? costs.competitor.map((cost, i) => cost - costs.ourEscalated[i]) : 
                    costs.baselineProgram.map((cost, i) => cost - costs.ourEscalated[i]);
                const savingsVsCompetitorFixed = costs.competitor ? costs.competitor.map((cost, i) => cost - costs.ourFixed[i]) : 
                    costs.baselineProgram.map((cost, i) => cost - costs.ourFixed[i]);
                updateSavingsHighlightCompetitor(savingsVsCompetitorEscalated[24], savingsVsCompetitorFixed[24]);
            }
        }

        // Update savings highlight
        function updateSavingsHighlight(savingsBase, savingsFlex) {
            const highlight = document.getElementById('savingsHighlight');
            
            if (presentationData.competitorType === 'flex') {
                if (!presentationData.escalatorAvailable && !presentationData.zeroInterestAvailable) {
                    // When no options are available
                    highlight.innerHTML = `
                        <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings</h3>
                        <p style="text-align: center; font-size: 1.1rem; color: #6b7280; margin-bottom: 2rem;">
                            No financing options available for comparison
                        </p>
                    `;
                } else if (!presentationData.escalatorAvailable) {
                    // When escalator is not available, show only fixed plan (which is our only option)
                    const costs = calculateCosts();
                    const fixedSavingsVsBaselineProgram = costs.baselineProgram[24] - costs.ourFixed[24];
                    const fixedSavingsVsFlexProgram = costs.flexProgram[24] - costs.ourFixed[24];
                    
                    highlight.innerHTML = `
                        <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings</h3>
                        <p style="text-align: center; font-size: 1.1rem; color: #6b7280; margin-bottom: 2rem;">
                            With Our Fixed Payment Plan
                        </p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div style="text-align: center;">
                                <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Baseline Program</p>
                                <div class="savings-number" style="color: #16a34a;">$${fixedSavingsVsBaselineProgram.toLocaleString('en-US')}</div>
                            </div>
                            <div style="text-align: center;">
                                <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Flex Program</p>
                                <div class="savings-number" style="color: #16a34a;">$${fixedSavingsVsFlexProgram.toLocaleString('en-US')}</div>
                            </div>
                        </div>
                    `;
                } else {
                    // When escalator is available, show escalator comparison ONLY (not fixed)
                    highlight.innerHTML = `
                        <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings</h3>
                        <p style="text-align: center; font-size: 1.1rem; color: #6b7280; margin-bottom: 2rem;">
                            With Our ${presentationData.ourEscalator}% Escalator Plan
                        </p>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div style="text-align: center;">
                                <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Baseline Program</p>
                                <div class="savings-number">$${savingsBase.toLocaleString('en-US')}</div>
                            </div>
                            <div style="text-align: center;">
                                <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Flex Program</p>
                                <div class="savings-number">$${savingsFlex.toLocaleString('en-US')}</div>
                            </div>
                        </div>
                    `;
                }
            } else {
                if (!presentationData.escalatorAvailable) {
                    // When escalator is not available for another competitor, show fixed plan
                    const costs = calculateCosts();
                    const fixedSavingsVsCompetitor = costs.competitor ? costs.competitor[24] - costs.ourFixed[24] : 
                        costs.baselineProgram[24] - costs.ourFixed[24];
                    
                    highlight.innerHTML = `
                        <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings</h3>
                        <p style="text-align: center; font-size: 1.1rem; color: #6b7280; margin-bottom: 2rem;">
                            With Our Fixed Payment Plan
                        </p>
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Competitor</p>
                            <div class="savings-number" style="color: #16a34a;">$${fixedSavingsVsCompetitor.toLocaleString('en-US')}</div>
                        </div>
                    `;
                } else {
                    // Another Competitor display with escalator
                    highlight.innerHTML = `
                        <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings</h3>
                        <p style="text-align: center; font-size: 1.1rem; color: #6b7280; margin-bottom: 2rem;">
                            With Our ${presentationData.ourEscalator}% Escalator Plan
                        </p>
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Competitor</p>
                            <div class="savings-number">$${savingsBase.toLocaleString('en-US')}</div>
                        </div>
                    `;
                }
            }
        }

        // Update savings highlight for competitor
        function updateSavingsHighlightCompetitor(savingsEscalated, savingsFixed) {
            const highlight = document.getElementById('savingsHighlight');
            
            if (!presentationData.escalatorAvailable) {
                // When escalator is not available, show only fixed plan (our only option)
                highlight.innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings vs Competitor</h3>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 2rem; justify-content: center;">
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">With Our Fixed Payment Plan</p>
                            <div class="savings-number" style="color: #16a34a;">$${savingsFixed >= 0 ? savingsFixed.toLocaleString('en-US') : '-' + Math.abs(savingsFixed).toLocaleString('en-US')}</div>
                            <p style="font-size: 0.9rem; color: #6b7280;">Monthly: $${presentationData.ourFixedPrice}</p>
                        </div>
                    </div>
                `;
            } else if (!presentationData.zeroInterestAvailable) {
                // When 0% is not available, show vs Baseline and vs Flex comparisons with escalator
                const costs = calculateCosts();
                const savingsVsBaselineProgram = costs.baselineProgram[24] - costs.ourEscalated[24];
                const savingsVsFlexProgram = costs.flexProgram[24] - costs.ourEscalated[24];
                
                highlight.innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings</h3>
                    <p style="text-align: center; font-size: 1.1rem; margin-bottom: 1.5rem; color: #6b7280;">With Our ${presentationData.ourEscalator}% Escalator Plan</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div style="text-align: center;">
                            <p style="font-size: 1rem; margin-bottom: 0.5rem; color: #374151;">vs Baseline Program</p>
                            <div class="savings-number" style="color: #16a34a;">$${savingsVsBaselineProgram.toLocaleString('en-US')}</div>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-size: 1rem; margin-bottom: 0.5rem; color: #374151;">vs Flex Program</p>
                            <div class="savings-number" style="color: #16a34a;">$${savingsVsFlexProgram.toLocaleString('en-US')}</div>
                        </div>
                    </div>
                `;
            } else {
                // Both options available - show escalator and fixed side by side
                highlight.innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 1rem; color: #16a34a;">Your 25-Year Savings vs Competitor</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">With Our ${presentationData.ourEscalator}% Escalated Plan</p>
                            <div class="savings-number" style="color: #16a34a;">$${savingsEscalated.toLocaleString('en-US')}</div>
                            <p style="font-size: 0.9rem; color: #6b7280;">Monthly: $${presentationData.ourPrice}</p>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">With Our Fixed Payment Plan</p>
                            <div class="savings-number" style="color: #16a34a;">$${savingsFixed >= 0 ? savingsFixed.toLocaleString('en-US') : '-' + Math.abs(savingsFixed).toLocaleString('en-US')}</div>
                            <p style="font-size: 0.9rem; color: #6b7280;">Monthly: $${presentationData.ourFixedPrice}</p>
                        </div>
                    </div>
                `;
            }
        }

        // Create fixed savings chart
        function createFixedSavingsChart() {
            const chartElement = document.getElementById('fixedSavingsChart');
            if (!chartElement) {
                return;
            }
            
            const ctx = chartElement.getContext('2d');
            const costs = calculateCosts();
            const years = Array.from({length: 25}, (_, i) => i + 1);
            
            const fixedSavingsVsBaselineProgram = costs.baselineProgram.map((cost, i) => cost - costs.ourFixed[i]);
            const fixedSavingsVsFlexProgram = costs.flexProgram.map((cost, i) => cost - costs.ourFixed[i]);

            if (fixedSavingsChart) fixedSavingsChart.destroy();

            fixedSavingsChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Savings vs Baseline Program (with our 0% fixed plan)',
                            data: fixedSavingsVsBaselineProgram,
                            borderColor: '#7c3aed',
                            backgroundColor: 'rgba(124, 58, 237, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'Savings vs Flex Program (with our 0% fixed plan)',
                            data: fixedSavingsVsFlexProgram,
                            borderColor: '#a855f7',
                            backgroundColor: 'rgba(168, 85, 247, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Cumulative Savings with Our 0% Fixed Plan',
                            font: {
                                size: 20
                            }
                        },
                        legend: {
                            labels: {
                                font: {
                                    size: 16
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    size: 14
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    size: 14
                                },
                                callback: function(value) {
                                    return '$' + value.toLocaleString('en-US');
                                }
                            }
                        }
                    }
                }
            });

            // Update fixed savings highlight
            updateFixedSavingsHighlight(fixedSavingsVsBaselineProgram[24], fixedSavingsVsFlexProgram[24]);
        }

        // Update fixed savings highlight
        function updateFixedSavingsHighlight(savingsBase, savingsFlex) {
            const highlight = document.getElementById('fixedSavingsHighlight');
            if (!highlight) {
                return;
            }
            
            // Get current fixed price from input (more reliable than presentationData)
            const currentFixedPrice = document.getElementById('ourFixedPriceInput').value || presentationData.ourFixedPrice;
            
            highlight.innerHTML = `
                <div class="fixed-plan-savings">
                    <h3 style="text-align: center; margin-bottom: 1rem; color: #7c3aed;">Your 25-Year Savings</h3>
                    <p style="text-align: center; font-size: 1.1rem; color: #6b7280; margin-bottom: 2rem;">
                        With Our 0% Fixed Payment Plan ($${currentFixedPrice}/month for 25 years)
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Baseline Program</p>
                            <div class="savings-number" style="color: ${savingsBase >= 0 ? '#16a34a' : '#dc2626'};">
                                ${savingsBase >= 0 ? '$' + savingsBase.toLocaleString('en-US') : '-$' + Math.abs(savingsBase).toLocaleString('en-US')}
                            </div>
                            <p style="font-size: 0.9rem; color: #6b7280;">
                                ${savingsBase >= 0 ? 'You save' : 'You pay more'}
                            </p>
                        </div>
                        <div style="text-align: center;">
                            <p style="font-size: 1.2rem; margin-bottom: 0.5rem;">vs Flex Program</p>
                            <div class="savings-number" style="color: ${savingsFlex >= 0 ? '#16a34a' : '#dc2626'};">
                                ${savingsFlex >= 0 ? '$' + savingsFlex.toLocaleString('en-US') : '-$' + Math.abs(savingsFlex).toLocaleString('en-US')}
                            </div>
                            <p style="font-size: 0.9rem; color: #6b7280;">
                                ${savingsFlex >= 0 ? 'You save' : 'You pay more'}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Update recommendation
        function updateRecommendation() {
            const costs = calculateCosts();
            const competitorType = presentationData.competitorType || 'flex';
            
            // Calculate 15-year costs
            const costs15Years = {
                baseline: costs.baselineProgram[14], // Array is 0-indexed, so [14] = year 15
                flex: costs.flexProgram[14],
                ourEscalated: costs.ourEscalated[14],
                ourFixed: costs.ourFixed[14]
            };
            
            // Only consider OUR solutions for recommendation (never recommend competitor)
            const ourPrograms = [
                { name: `Our ${presentationData.ourEscalator}% Escalated Solution`, cost: costs15Years.ourEscalated, monthly: presentationData.ourPrice }
            ];

            // Add fixed plan only if 0% financing is available
            if (presentationData.zeroInterestAvailable) {
                ourPrograms.push({ name: 'Our Fixed Solution', cost: costs15Years.ourFixed, monthly: presentationData.ourFixedPrice });
            }
            
            // Sort OUR programs by 15-year cost to find the best option
            ourPrograms.sort((a, b) => a.cost - b.cost);
            const recommendedSolution = ourPrograms[0];
            const alternativeSolution = ourPrograms[1];
            
            // Calculate savings vs competitor programs for context
            const savingsVsBaseline = costs15Years.baseline - recommendedSolution.cost;
            const savingsVsFlex = costs15Years.flex - recommendedSolution.cost;
            
            // Generate savings lines based on competitor type
            let savingsLines = '';
            if (competitorType === 'flex') {
                // Show both Baseline and Flex comparisons for Flex Program mode
                savingsLines = `
                    <li style="margin-bottom: 0.5rem;"><strong>Saves vs Baseline Program:</strong> $${savingsVsBaseline.toLocaleString('en-US')} in 15 years</li>
                    <li style="margin-bottom: 0.5rem;"><strong>Saves vs Flex Program:</strong> $${savingsVsFlex.toLocaleString('en-US')} in 15 years</li>
                `;
            } else {
                // Show only competitor comparison for Another Competitor mode
                const competitorSavings = costs15Years.baseline - recommendedSolution.cost; // Using baseline as generic competitor
                savingsLines = `
                    <li style="margin-bottom: 0.5rem;"><strong>Saves vs Competitor:</strong> $${competitorSavings.toLocaleString('en-US')} in 15 years</li>
                `;
            }
            
            // Calculate 25-year savings for context
            const savingsBase = costs.baselineProgram[24] - costs.ourEscalated[24];
            const savingsFlex = costs.flexProgram[24] - costs.ourEscalated[24];
            
            const recommendation = document.getElementById('recommendationContent');

            recommendation.innerHTML = `
                <div style="text-align: center;">
                    <span class="recommendation-badge">RECOMMENDED</span>
                    <h3 style="color: #16a34a; margin: 1rem 0;">${recommendedSolution.name}</h3>
                    <p style="font-size: 1.2rem; color: #374151; margin-bottom: 2rem;">
                        Our best solar solution for your energy needs - proven savings and superior value.
                    </p>
                    <div style="background: #f8f8f8; padding: 2rem; margin: 2rem 0;">
                        <h4 style="color: #16a34a; margin-bottom: 1rem;">Why This Is Perfect For You:</h4>
                        <ul style="text-align: left; max-width: 600px; margin: 0 auto; color: #374151;">
                            <li style="margin-bottom: 0.5rem;"><strong>Our lowest 15-year cost:</strong> $${recommendedSolution.cost.toLocaleString('en-US')}</li>
                            <li style="margin-bottom: 0.5rem;"><strong>Starting payment:</strong> $${recommendedSolution.monthly}/month</li>
                            ${savingsLines}
                            <li style="margin-bottom: 0.5rem;">No access restrictions or additional fees</li>
                            <li style="margin-bottom: 0.5rem;">Complete control over your solar production</li>
                            ${alternativeSolution ? 
                                `<li style="margin-bottom: 0.5rem;">Alternative option available: ${alternativeSolution.name}</li>` : 
                                ''
                            }
                        </ul>
                    </div>
                    <div style=" padding: 1.5rem; border-left: 4px solid #16a34a; margin: 1.5rem 0;">
                        <p style="font-size: 0.95rem; color: #374151; margin: 0;">
                            <strong>Why Choose Axia:</strong> We always recommend our best solution for you - never a competitor program. 
                            Our focus is providing you with the maximum value and savings.
                        </p>
                    </div>
                    <p style="font-style: italic; color: #6b7280;">
                        Ready to start saving? Let's discuss your solar journey today!
                    </p>
                </div>
            `;
        }

        // Update comparison table values
        function updateComparisonTable() {
            try {
                console.log('updateComparisonTable starting...');
                const competitorType = presentationData.competitorType || 'flex';
            
            // Get current values from inputs
            const currentFlexPrice = parseFloat(document.getElementById('sunrunFlexPriceInput').value) || presentationData.sunrunFlexPrice || 248.96;
            const currentBasePrice = parseFloat(document.getElementById('sunrunBasePriceInput').value) || presentationData.sunrunBasePrice || 215.14;
            const currentCompetitorPrice = parseFloat(document.getElementById('competitorPriceInput').value) || presentationData.competitorPrice || 215.14;
            
            // Update table title and header based on competitor type
            const titleElement = document.getElementById('comparisonTableTitle');
            const headerElement = document.getElementById('comparisonTableCompetitorHeader');
            
            if (competitorType === 'flex') {
                titleElement.textContent = 'Complete Comparison: Flex Program vs Our Solar Solution';
                headerElement.textContent = 'Flex Program';
            } else {
                titleElement.textContent = 'Complete Comparison: Competitor vs Our Solar Solution';
                headerElement.textContent = 'Competitor';
            }
            
            // Update Energy Access cell content
            const energyAccessCell = document.getElementById('energyAccessCell');
            if (competitorType === 'flex') {
                energyAccessCell.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                        <span>Limited baseline access</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;"><span id="comparisonBaselineDisplay">${presentationData.baselineUsage.toLocaleString('en-US')}</span> kWh/year included, extra charged separately</div>
                `;
            } else {
                energyAccessCell.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <i class="fas fa-check" style="color: #16a34a; margin-right: 8px;"></i>
                        <span>Full system access</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;"><span id="comparisonBaselineDisplay">${presentationData.competitorProduction?.toLocaleString('en-US') || presentationData.sunrunProduction.toLocaleString('en-US')}</span> kWh/year production included</div>
                `;
            }
            
            // Update Escalator cell content
            const escalatorCell = document.getElementById('escalatorCell');
            if (competitorType === 'flex') {
                escalatorCell.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                        <span>Mandatory 3.5% annual</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;">No fixed payment option</div>
                `;
            } else {
                escalatorCell.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                        <span>Mandatory ${presentationData.competitorEscalator || '3.5'}% annual</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;">No fixed payment option</div>
                `;
            }
            
            // Update System Sizing cell content
            const systemSizingCell = document.getElementById('systemSizingCell');
            const oversizedPercentage = Math.round((presentationData.systemSize / presentationData.usage) * 100);
            if (competitorType === 'flex') {
                systemSizingCell.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <i class="fas fa-times" style="color: #dc2626; margin-right: 8px;"></i>
                        <span>Oversized</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;">Systems <span id="comparisonOversizedDisplay">${oversizedPercentage}%</span> larger than your actual consumption</div>
                `;
            } else {
                // For another competitor, we can assume they might also be oversized or appropriately sized
                systemSizingCell.innerHTML = `
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <i class="fas fa-question-circle" style="color: #f59e0b; margin-right: 8px;"></i>
                        <span>Standard sizing</span>
                    </div>
                    <div style="font-size: 0.875rem; color: #6b7280;">System size varies by provider</div>
                `;
            }
            
            // Update escalator displays (only if they exist)
            const comparisonEscalatorDisplay = document.getElementById('comparisonEscalatorDisplay');
            if (comparisonEscalatorDisplay) {
                comparisonEscalatorDisplay.textContent = presentationData.ourEscalator;
            }
            
            const comparisonOurEscalatorDisplay = document.getElementById('comparisonOurEscalatorDisplay');
            if (comparisonOurEscalatorDisplay) {
                comparisonOurEscalatorDisplay.textContent = presentationData.ourEscalator;
            }
            
            // Update our payment options description based on escalator availability
            const ourPaymentDescription = document.getElementById('ourPaymentOptionsDescription');
            if (ourPaymentDescription) {
                if (presentationData.escalatorAvailable) {
                    ourPaymentDescription.innerHTML = `Choose <span id="comparisonOurEscalatorDisplay">${presentationData.ourEscalator}%</span> escalator or fixed payment (0%)`;
                } else {
                    ourPaymentDescription.innerHTML = `Fixed payment (0%)`;
                }
            }
            
            // Update payment ranges based on competitor type
            const paymentCell = document.getElementById('competitorPaymentCell');
            const paymentDescription = document.getElementById('competitorPaymentDescription');
            
            if (competitorType === 'flex') {
                // Flex Program payment range - use current input values
                paymentCell.innerHTML = `
                    <div style="font-size: 1.125rem; font-weight: 600;">$<span id="comparisonFlexMinDisplay">${currentBasePrice.toFixed(2)}</span> - $<span id="comparisonFlexMaxDisplay">${currentFlexPrice.toFixed(2)}</span></div>
                    <div style="font-size: 0.875rem; color: #6b7280;" id="competitorPaymentDescription">Always increases 3.5% annually</div>
                `;
            } else {
                // Another Competitor single price
                paymentCell.innerHTML = `
                    <div style="font-size: 1.125rem; font-weight: 600;">$<span id="comparisonCompetitorPriceDisplay">${currentCompetitorPrice.toFixed(2)}</span>/month</div>
                    <div style="font-size: 0.875rem; color: #6b7280;" id="competitorPaymentDescription">Increases ${presentationData.competitorEscalator || '3.5'}% annually</div>
                `;
            }
            
            // Update our price display based on escalator availability
            // Get current values from inputs
            const currentOurPrice = parseFloat(document.getElementById('ourPriceInput').value) || presentationData.ourPrice;
            const currentOurFixedPrice = parseFloat(document.getElementById('ourFixedPriceInput').value) || presentationData.ourFixedPrice;
            
            if (presentationData.escalatorAvailable) {
                // Show range when escalator is available
                const comparisonOurPriceDisplay = document.getElementById('comparisonOurPriceDisplay');
                const comparisonOurFixedDisplay = document.getElementById('comparisonOurFixedDisplay');
                
                if (comparisonOurPriceDisplay) {
                    comparisonOurPriceDisplay.textContent = currentOurPrice;
                }
                if (comparisonOurFixedDisplay) {
                    comparisonOurFixedDisplay.textContent = currentOurFixedPrice;
                }
                
                // Update the price cell to show range format
                const ourPriceCell = document.querySelector('td:has(#comparisonOurPriceDisplay)');
                if (ourPriceCell) {
                    ourPriceCell.children[0].innerHTML = `$<span id="comparisonOurPriceDisplay">${currentOurPrice}</span> - $<span id="comparisonOurFixedDisplay">${currentOurFixedPrice}</span>`;
                }
            } else {
                // Show only fixed price when escalator is not available
                const ourPriceCell = document.querySelector('td:has(#comparisonOurPriceDisplay)');
                if (ourPriceCell) {
                    ourPriceCell.children[0].innerHTML = `$<span id="comparisonOurFixedDisplay">${currentOurFixedPrice}</span>/month`;
                }
            }
        } catch (error) {
            console.error('Error in updateComparisonTable:', error);
        }
        }

        // Update financial impact table
        function updateFinancialImpactTable() {
            // Use the same calculateCosts() function that Your Potential Savings uses
            const costs = calculateCosts();
            
            const competitorType = document.getElementById('competitorTypeSelect').value;
            const escalator = presentationData.ourEscalator / 100;
            
            // Get current values from inputs for more accurate calculations
            const currentBasePrice = parseFloat(document.getElementById('sunrunBasePriceInput').value) || presentationData.sunrunBasePrice || 215.14;
            const currentFlexPrice = parseFloat(document.getElementById('sunrunFlexPriceInput').value) || presentationData.sunrunFlexPrice || 248.96;
            const currentCompetitorPrice = parseFloat(document.getElementById('competitorPriceInput').value) || presentationData.competitorPrice || 215.14;
            
            // Use the appropriate price based on competitor type
            const flexPrice = competitorType === 'flex' ? currentBasePrice : currentCompetitorPrice;
            
            // Get current values from inputs (more reliable than presentationData)
            const ourEscalatedPrice = parseFloat(document.getElementById('ourPriceInput').value) || presentationData.ourPrice;
            const ourFixedPrice = parseFloat(document.getElementById('ourFixedPriceInput').value) || presentationData.ourFixedPrice;
            
            // Update header based on competitor type
            const headerElement = document.getElementById('competitorTableHeader');
            if (headerElement) {
                if (competitorType === 'other') {
                    headerElement.textContent = 'Competitor Program';
                } else {
                    headerElement.textContent = 'Baseline Program';
                }
            }
            
            // Update escalator header
            document.getElementById('impactEscalatorHeader').textContent = presentationData.ourEscalator + '%';
            
            // Calculate payments for different years (without year 20)
            const years = [1, 5, 10, 15, 25];
            
            years.forEach(year => {
                // Flex Program (3.5% escalator) - minimum base payment
                const flexPaymentMin = flexPrice * Math.pow(1.035, year - 1);
                // Maximum with Flex Rate charges (estimate 20-40% higher due to peak usage)
                const flexPaymentMax = flexPaymentMin * 1.3; // 30% higher for peak usage
                document.getElementById(`impactFlexYear${year}`).textContent = flexPaymentMin.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                
                // Update max price display 
                const maxElement = document.getElementById(`impactFlexYear${year}Max`);
                if (maxElement) {
                    maxElement.textContent = flexPaymentMax.toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                }
                
                // Our Fixed
                document.getElementById(`impactFixedYear${year}`).textContent = ourFixedPrice.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
                
                // Our Escalated
                const escalatedPayment = ourEscalatedPrice * Math.pow(1 + escalator, year - 1);
                document.getElementById(`impactEscalatedYear${year}`).textContent = escalatedPayment.toLocaleString('en-US', {
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                });
            });
            
            // Calculate complete 25-year totals using the same method as Your Potential Savings
            const baseline25Total = costs.baselineProgram[24]; // Index 24 = year 25
            const flex25Total = costs.flexProgram[24]; // Index 24 = year 25
            const fixed25Total = costs.ourFixed[24];
            const escalated25Total = costs.ourEscalated[24];
            
            // Maximum Flex total (30% higher) - keep this for display consistency
            const flex25TotalMax = flex25Total * 1.3;
            
            // Update totals using the same calculated values
            document.getElementById('impactBaseline25Total').textContent = Math.round(baseline25Total).toLocaleString('en-US');
            document.getElementById('impactFixed25Total').textContent = Math.round(fixed25Total).toLocaleString('en-US');
            document.getElementById('impactEscalated25Total').textContent = Math.round(escalated25Total).toLocaleString('en-US');
            
            // Calculate savings using the same method as Your Potential Savings
            const fixed25Savings = baseline25Total - fixed25Total;
            const escalated25Savings = baseline25Total - escalated25Total;
            
            document.getElementById('impactFixed25Savings').textContent = Math.round(fixed25Savings).toLocaleString('en-US');
            document.getElementById('impactEscalated25Savings').textContent = Math.round(escalated25Savings).toLocaleString('en-US');
            
            // Handle competitor-specific text visibility
            const isCompetitor = competitorType === 'other';
            
            // Hide/show flex-only text
            const flexOnlyElements = document.querySelectorAll('.flex-only-text');
            flexOnlyElements.forEach(el => {
                el.style.display = isCompetitor ? 'none' : '';
            });
            
            // Show/hide competitor savings
            const competitorSavingsElements = document.querySelectorAll('.competitor-savings');
            competitorSavingsElements.forEach(el => {
                el.style.display = isCompetitor ? 'block' : 'none';
            });
            
            // Update competitor savings values
            if (isCompetitor) {
                document.getElementById('impactFixed25CompetitorSavings').textContent = Math.round(fixed25Savings).toLocaleString('en-US');
                document.getElementById('impactEscalated25CompetitorSavings').textContent = Math.round(escalated25Savings).toLocaleString('en-US');
                
                // Change description texts for competitor mode
                const year10Desc = document.getElementById('escalatedYear10Description');
                const year25Desc = document.getElementById('escalatedYear25Description');
                if (year10Desc) year10Desc.textContent = 'Still competitive';
                if (year25Desc) year25Desc.textContent = 'Still much lower';
            } else {
                // Restore original Flex descriptions
                const year10Desc = document.getElementById('escalatedYear10Description');
                const year25Desc = document.getElementById('escalatedYear25Description');
                if (year10Desc) year10Desc.textContent = 'Still below Flex maximum';
                if (year25Desc) year25Desc.textContent = 'Still much lower than Flex';
            }
        }

        // Create access comparison chart
        function createAccessChart() {
            const ctx = document.getElementById('accessChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (accessChart) {
                accessChart.destroy();
            }

            // Use values from presentationData like in V1
            const sunrunBaseProduction = presentationData.baselineUsage; // Baseline included
            const sunrunFlexProduction = presentationData.sunrunProduction; // Total Flex production
            const ourProduction = presentationData.ourProduction; // Our total production
            
            // Calculate the extra amount (difference between Flex total and Baseline)
            const sunrunExtraAccess = sunrunFlexProduction - sunrunBaseProduction;

            console.log('Access chart data:', {
                sunrunBaseProduction,
                sunrunFlexProduction, 
                sunrunExtraAccess,
                ourProduction
            });

            // Calculate max value to determine appropriate scale
            const maxValue = Math.max(sunrunFlexProduction, ourProduction);
            let suggestedMax;
            
            // Set scale in increments
            if (maxValue <= 5000) {
                suggestedMax = Math.ceil(maxValue / 500) * 500;
            } else if (maxValue <= 10000) {
                suggestedMax = Math.ceil(maxValue / 1000) * 1000;
            } else {
                suggestedMax = Math.ceil(maxValue / 2000) * 2000;
            }

            accessChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Flex Program', 'Axia by Qcells'],
                    datasets: [
                        {
                            label: 'Baseline (included)',
                            data: [sunrunBaseProduction, 0],
                            backgroundColor: '#1e40af',
                            borderColor: '#1e40af',
                            borderWidth: 0,
                            borderRadius: 0,
                            borderSkipped: false,
                            barThickness: 120,
                        },
                        {
                            label: 'Charged extra (Flex)',
                            data: [sunrunExtraAccess, 0],
                            backgroundColor: '#dc2626',
                            borderColor: '#dc2626',
                            borderWidth: 0,
                            borderRadius: 0,
                            borderSkipped: false,
                            barThickness: 120,
                        },
                        {
                            label: 'Complete access (Axia)',
                            data: [0, ourProduction],
                            backgroundColor: '#059669',
                            borderColor: '#059669',
                            borderWidth: 0,
                            borderRadius: 0,
                            borderSkipped: false,
                            barThickness: 120,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 20,
                            bottom: 20,
                            left: 20,
                            right: 20
                        }
                    },
                    plugins: {
                        legend: {
                            display: false // Hidden since we have custom legend
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: 'white',
                            bodyColor: 'white',
                            borderColor: 'rgba(0, 0, 0, 0.1)',
                            borderWidth: 1,
                            cornerRadius: 8,
                            titleFont: {
                                size: 14,
                                weight: '600'
                            },
                            bodyFont: {
                                size: 13
                            },
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toLocaleString('en-US') + ' kWh/year';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: '#1f2937',
                                font: {
                                    size: 16,
                                    weight: '600'
                                },
                                padding: 15
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            suggestedMax: suggestedMax,
                            grid: {
                                color: 'rgba(156, 163, 175, 0.3)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#6b7280',
                                font: {
                                    size: 12,
                                    weight: '500'
                                },
                                padding: 10,
                                stepSize: maxValue <= 5000 ? 500 : (maxValue <= 10000 ? 1000 : 2000),
                                callback: function(value) {
                                    return (value / 1000).toFixed(0) + 'k kWh';
                                }
                            }
                        }
                    }
                }
            });

            // Update display values
            updateAccessDisplayValues();
        }

        // Update access comparison when inputs change
        function updateAccessComparison() {
            updateAccessDisplayValues();
            createAccessChart();
        }

        // Update display values in the access section
        function updateAccessDisplayValues() {
            // Use values from presentationData like in V1
            const sunrunBaseProduction = presentationData.baselineUsage; // Baseline included
            const sunrunFlexProduction = presentationData.sunrunProduction; // Total Flex production
            const ourProduction = presentationData.ourProduction; // Our total production
            
            // Calculate the extra amount (difference between Flex total and Baseline)
            const extraAmount = sunrunFlexProduction - sunrunBaseProduction;
            const flexRate = 0.15; // Default flex rate
            const extraCost = Math.round(extraAmount * flexRate);

            // Update display elements
            if (document.getElementById('accessBaselineAmount')) {
                document.getElementById('accessBaselineAmount').textContent = sunrunBaseProduction.toLocaleString('en-US');
            }
            if (document.getElementById('accessExtraAmount')) {
                document.getElementById('accessExtraAmount').textContent = extraAmount.toLocaleString('en-US');
            }
            if (document.getElementById('accessOurTotal')) {
                document.getElementById('accessOurTotal').textContent = ourProduction.toLocaleString('en-US');
            }
            if (document.getElementById('impactExtraKwh')) {
                document.getElementById('impactExtraKwh').textContent = extraAmount.toLocaleString('en-US');
            }
            if (document.getElementById('impactExtraCost')) {
                document.getElementById('impactExtraCost').textContent = extraCost.toLocaleString('en-US');
            }
            // Update second slide values
            if (document.getElementById('impactExtraKwh2')) {
                document.getElementById('impactExtraKwh2').textContent = extraAmount.toLocaleString('en-US');
            }
            if (document.getElementById('impactExtraCost2')) {
                document.getElementById('impactExtraCost2').textContent = extraCost.toLocaleString();
            }

            console.log('Access values updated:', {
                sunrunBaseProduction,
                sunrunFlexProduction,
                extraAmount,
                ourProduction,
                extraCost
            });
        }

        // Show content and update analysis
        function showUpdatedContent() {
            // Show the content
            const content = document.querySelector('.analysis-content');
            content.classList.remove('hidden');
            content.style.opacity = '1';
            
            // Update all calculations and displays
            updateAll();
        }

        // Update all calculations and displays
        function updateAll() {
            console.log('updateAll() starting...');
            updateDisplayValues();
            updateComparisonTable();
            updateFinancialImpactTable();
            updateRecommendation();
            
            console.log('About to call createMonthlyChart...');
            createMonthlyChart();
            createSavingsChart();
            createFixedSavingsChart();
            
            // Only update access comparison for Flex Program
            const competitorType = document.getElementById('competitorTypeSelect').value;
            if (competitorType === 'flex') {
                updateAccessComparison();
            }
        }

        // Handle competitor type change
        function updateCompetitorType() {
            const competitorType = document.getElementById('competitorTypeSelect').value;
            const flexFields = document.getElementById('flexProgramFields');
            const otherFields = document.getElementById('otherCompetitorFields');
            const accessSlide = document.getElementById('partialVsFullAccessSlide');
            const annualImpactSlide = document.getElementById('annualFinancialImpactSlide');
            const fixedPlanSlide = document.getElementById('fixedPlanSavingsSlide');
            const savingsChartContainer = document.getElementById('savingsChartContainer');
            const competitorPricingContainer = document.getElementById('competitorPricingContainer');
            
            if (competitorType === 'flex') {
                // Show Flex Program fields
                flexFields.style.display = 'block';
                otherFields.style.display = 'none';
                
                // Show Partial vs Full Access slide
                if (accessSlide) {
                    accessSlide.style.display = 'block';
                }
                
                // Show Annual Financial Impact slide
                if (annualImpactSlide) {
                    annualImpactSlide.style.display = 'block';
                }
                
                // Show Fixed Plan Savings slide only if 0% financing is available
                const zeroInterestAvailable = document.getElementById('zeroInterestAvailableInput').value === 'yes';
                if (fixedPlanSlide && zeroInterestAvailable) {
                    fixedPlanSlide.style.display = 'block';
                } else if (fixedPlanSlide) {
                    fixedPlanSlide.style.display = 'none';
                }
                
                // Show both Baseline and Flex prices for Flex Program
                if (competitorPricingContainer) {
                    competitorPricingContainer.innerHTML = `
                        <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem; margin-bottom: 1rem;">
                            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                Baseline Price (3.5% escalator)
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #dc2626;">
                                $<span id="sunrunBasePriceDisplay">215.14</span>/month
                            </div>
                        </div>
                        <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem;">
                            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                Flex Price (3.5% escalator)
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #dc2626;">
                                $<span id="sunrunFlexPriceDisplay">248.96</span>/month
                            </div>
                        </div>
                    `;
                }
                
                // Normal chart size for Flex Program
                if (savingsChartContainer) {
                    savingsChartContainer.style.height = '400px';
                }
            } else {
                // Show Other Competitor fields  
                flexFields.style.display = 'none';
                otherFields.style.display = 'block';
                
                // Hide Partial vs Full Access slide
                if (accessSlide) {
                    accessSlide.style.display = 'none';
                }
                
                // Hide Annual Financial Impact slide
                if (annualImpactSlide) {
                    annualImpactSlide.style.display = 'none';
                }
                
                // Hide Fixed Plan Savings slide (to avoid duplication)
                if (fixedPlanSlide) {
                    fixedPlanSlide.style.display = 'none';
                }
                
                // Show only one price for Another Competitor
                if (competitorPricingContainer) {
                    competitorPricingContainer.innerHTML = `
                        <div style="background: white; border: 1px solid #e5e7eb; padding: 1.5rem;">
                            <div style="font-size: 0.9rem; color: #6b7280; margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.05em;">
                                Monthly Price (<span id="competitorEscalatorDisplay">3.5%</span> escalator)
                            </div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #dc2626;">
                                $<span id="competitorPriceDisplay">215.14</span>/month
                            </div>
                        </div>
                    `;
                }
                
                // Larger chart size for Another Competitor
                if (savingsChartContainer) {
                    savingsChartContainer.style.height = '600px';
                }
            }
            
            // Update presentation data
            updatePresentation();
        }

        // Initialize the application
        function init() {
            // Initialize competitor type (removed panel-visible class)
            updateCompetitorType();
            
            // Initialize baselineUsage from the input field
            const baseProductionInput = document.getElementById('sunrunBaseProductionInput');
            if (baseProductionInput) {
                presentationData.baselineUsage = parseFloat(baseProductionInput.value) || 9605;
            }

            // Initialize all charts
            createMonthlyChart();
            createSavingsChart();
            createFixedSavingsChart();
            createAccessChart();
            
            // Update all data displays
            updateAll();

            // Add event listeners for automatic updates
            const inputFields = [
                'sunrunBaseProductionInput',
                'sunrunFlexProductionInput', 
                'competitorProductionInput',
                'ourProductionInput'
            ];

            inputFields.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        console.log(`Field ${id} changed to:`, this.value);
                        updatePresentation();
                    });
                }
            });

            // Initialize all calculations and displays
            setTimeout(() => {
                updateAccessComparison();
                updateAll();
            }, 100);
        }

        // Update Presentation function - triggered by panel button
        function updatePresentation() {
            // Update data from panel inputs
            presentationData.clientName = document.getElementById('clientNameInput').value;
            
            const competitorType = document.getElementById('competitorTypeSelect').value;
            presentationData.competitorType = competitorType;
            
            if (competitorType === 'flex') {
                // Flex Program data - THESE ARE THE CORRECT VALUES FOR THE CHART
                presentationData.baselineUsage = parseFloat(document.getElementById('sunrunBaseProductionInput').value) || 0;
                presentationData.sunrunProduction = parseFloat(document.getElementById('sunrunFlexProductionInput').value) || 0;
                presentationData.sunrunBasePrice = parseFloat(document.getElementById('sunrunBasePriceInput').value) || 0;
                presentationData.sunrunFlexPrice = parseFloat(document.getElementById('sunrunFlexPriceInput').value) || 0;
                presentationData.sunrunEscalator = parseFloat(document.getElementById('sunrunEscalatorInput').value) || 0;
                
                // Backward compatibility - keep these for existing calculations
                presentationData.sunrunBaseProduction = presentationData.baselineUsage;
                presentationData.sunrunFlexProduction = presentationData.sunrunProduction;
            } else {
                // Other Competitor data
                presentationData.competitorProduction = parseFloat(document.getElementById('competitorProductionInput').value) || 0;
                presentationData.competitorPrice = parseFloat(document.getElementById('competitorPriceInput').value) || 0;
                presentationData.competitorEscalator = parseFloat(document.getElementById('competitorEscalatorInput').value) || 0;
                
                // Map to existing variables for compatibility
                presentationData.sunrunProduction = presentationData.competitorProduction;
                presentationData.sunrunBasePrice = presentationData.competitorPrice;
                presentationData.sunrunFlexPrice = presentationData.competitorPrice;
                presentationData.sunrunEscalator = presentationData.competitorEscalator;
                presentationData.baselineUsage = presentationData.competitorProduction;
            }
            
            // Always update Axia data
            presentationData.ourProduction = parseFloat(document.getElementById('ourProductionInput').value) || 0;
            presentationData.ourPrice = parseFloat(document.getElementById('ourPriceInput').value) || 0;
            presentationData.ourFixedPrice = parseFloat(document.getElementById('ourFixedPriceInput').value) || 0;
            
            const escalatorValue = document.getElementById('ourEscalatorInput').value;
            presentationData.ourEscalator = escalatorValue === 'none' ? 0 : parseFloat(escalatorValue) || 0;
            presentationData.escalatorAvailable = escalatorValue !== 'none';
            
            console.log('Escalator update:', {
                escalatorValue: escalatorValue,
                ourEscalator: presentationData.ourEscalator,
                escalatorAvailable: presentationData.escalatorAvailable,
                competitorType: presentationData.competitorType
            });
            
            presentationData.zeroInterestAvailable = document.getElementById('zeroInterestAvailableInput').value === 'yes';
            presentationData.showOversizedMessage = document.getElementById('oversizedMessageInput').value === 'yes';

            // Apply/remove CSS class based on 0% financing availability
            const body = document.body;
            if (presentationData.zeroInterestAvailable) {
                body.classList.remove('zero-interest-hidden');
            } else {
                body.classList.add('zero-interest-hidden');
            }

            // Apply/remove CSS class based on escalator availability
            if (presentationData.escalatorAvailable) {
                body.classList.remove('escalator-hidden');
            } else {
                body.classList.add('escalator-hidden');
            }

            // Apply/remove CSS class based on oversizing message visibility
            if (presentationData.showOversizedMessage) {
                body.classList.remove('oversizing-hidden');
            } else {
                body.classList.add('oversizing-hidden');
            }

            // The analysis content is now always visible, just update calculations
            setTimeout(() => {
                updateAll();
            }, 100);

            console.log('Presentation updated from panel - Type:', competitorType);
            console.log('Updated data:', {
                baselineUsage: presentationData.baselineUsage,
                sunrunProduction: presentationData.sunrunProduction,
                ourProduction: presentationData.ourProduction
            });
        }

        // Function specifically for updating when inputs change
        function updatePresentationAndRefresh() {
            updatePresentation();
            
            // Force refresh of fixed savings chart if no escalator
            setTimeout(() => {
                if (document.body.classList.contains('escalator-hidden')) {
                    createFixedSavingsChart();
                }
            }, 150);
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
